<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Backups :: Apache Cassandra Documentation</title>
    <link rel="canonical" href="file:///Users/lorina.poland/CLONES/cassandra/build/html/Cassandra/4.0/Cassandra/3.11/cassandra/operating/backups.html">
    <meta name="generator" content="Antora 2.3.1">
    <link rel="stylesheet" href="../../../../_/css/site.css">
<link rel="stylesheet" href="../../../../_/css/search.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="file:///Users/lorina.poland/CLONES/cassandra/build/html/Cassandra/4.0">&nbsp;&nbsp;&nbsp;<img src="../../../../_/img/cassandra_logo.png"></a>
        <div class="navbar-item">
          <input id="search-input" type="text" placeholder="Search docs">
        </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://cassandra.apache.org">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="https://cassandra.apache.org/download/">Download</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://www.apache.org/dyn/closer.lua/cassandra/3.11.6/apache-cassandra-3.11.6-bin.tar.gz">Latest</a>
            <a class="navbar-item" href="https://www.apache.org/dyn/closer.lua/cassandra/3.11.6/apache-cassandra-3.11.6-bin.tar.gz">3.x</a>
            <a class="navbar-item" href="https://www.apache.org/dyn/closer.lua/cassandra/3.0.20/apache-cassandra-3.0.20-bin.tar.gz">3.0</a>
            <a class="navbar-item" href="https://www.apache.org/dyn/closer.lua/cassandra/2.1.21/apache-cassandra-2.1.21-bin.tar.gz">2.1</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="https://cassandra.apache.org/doc/">Documentation</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://cassandra.apache.org/doc/">Latest</a>
            <a class="navbar-item" href="">3.x</a>
            <a class="navbar-item" href="https://cassandra.apache.org/doc/old/CQL-3.0.html">3.0</a>
            <a class="navbar-item" href="https://cassandra.apache.org/doc/old/CQL-2.1.html">2.1</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="https://cassandra.apache.org/community/">Community</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://lists.apache.org/list.html?dev@cassandra.apache.org">Developer Mailing List</a>
            <a class="navbar-item" href="https://lists.apache.org/list.html?user@cassandra.apache.org">User Mailing List</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="https://cassandra.apache.org/blog/">Blog</a>
	</div>
          </span>
        </div>
      </div>
    </div>
  </nav>
  <nav class="navbar2">
    <div class="navbar2-brand">
      <a class="navbar2-item href="https://asf.org"><img src="../../../../_/img/asf_feather.png" height="70%">&nbsp;&nbsp;&nbsp;Apache Software Foundation / Apache Cassandra</a>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="Cassandra" data-version="4.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../index.html">Cassandra</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../index.html">Main</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../glossary.html">Glossary</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../bugs.html">How to report bugs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../contactus.html">Contact us</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Cassandra</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../getting_started/index.html">Getting Started</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../getting_started/installing.html">Installing Cassandra</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../getting_started/configuring.html">Configuring Cassandra</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../getting_started/querying.html">Inserting and querying</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../getting_started/drivers.html">Client drivers</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../getting_started/production.html">Production recommendations</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../new/index.html">What&#8217;s new</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../new/java11.html">Support for Java 11</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../new/virtualtables.html">Virtual tables</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../new/auditlogging.html">Audit logging</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../new/fqllogging.html">Full query logging</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../new/messaging.html">Improved internode Messaging</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../new/streaming.html">Improved streaming</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../new/transientreplication.html">Transient replication</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../architecture/index.html">Architecture</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../architecture/overview.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../architecture/dynamo.html">Dynamo</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../architecture/storage_engine.html">Storage engine</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../architecture/guarantees.html">Guarantees</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../data_modeling/index.html">Data modeling</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../data_modeling/intro.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../data_modeling/data_modeling_conceptual.html">Conceptual data modeling</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../data_modeling/data_modeling_rdbms.html">RDBMS design</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../data_modeling/data_modeling_queries.html">Defining application queries</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../data_modeling/data_modeling_logical.html">Logical data modeling</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../data_modeling/data_modeling_physical.html">Physical data modeling</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../data_modeling/data_modeling_refining.html">Evaluating and refining data models</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../data_modeling/data_modeling_schema.html">Defining database schema</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../data_modeling/data_modeling_tools.html">Cassandra data modeling tools</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../cql/index.html">Cassandra Query Language (CQL)</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/definitions.html">Definitions</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/types.html">Data types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/ddl.html">Data definition (DDL)</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/dml.html">Data manipulation (DML)</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/operators.html">Operators</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/indexes.html">Secondary indexes</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/mvs.html">Materialized views</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/functions.html">Functions</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/json.html">JSON</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/security.html">Security</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/triggers.html">Triggers</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/appendices.html">Appendices</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/changes.html">Changes</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../configuration/index.html">Configuration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../configuration/cass_yaml_file.html">cassandra.yaml</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../configuration/cass_rackdc_file.html">cassandra-rackdc.properties</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../configuration/cass_env_sh_file.html">cassandra-env.sh</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../configuration/cass_topo_file.html">cassandra-topologies.properties</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../configuration/cass_cl_archive_file.html">commitlog-archiving.properties</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../configuration/cass_logback_xml_file.html">logback.xml</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../configuration/cass_jvm_options_file.html">jvm-* files</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Operating</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="snitch.html">Snitches</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="topo_changes.html">Topology changes</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="repair.html">Repair</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="read_repair.html">Read repair</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="hints.html">Hints</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="bloom_filters.html">Bloom filters</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="compression.html">Compression</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="cdc.html">Change Data Capture (CDC)</a>
  </li>
  <li class="nav-item is-current-page" data-depth="3">
    <a class="nav-link" href="backups.html">Backups</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="bulk_loading.html">Bulk loading</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="metrics.html">Metrics</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="security.html">Security</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="hardware.html">Hardware</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="audit_logging.html">Audit logging</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="compaction/index.html">Compaction</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../tools/index.html">Tools</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../tools/cqlsh.html">cqlsh: the CQL shell</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../tools/nodetool/nodetool.html">nodetool</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../tools/sstable/index.html">SSTable tools</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../tools/cassandra_stress.html">cassandra-stress</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../troubleshooting/index.html">Troubleshooting</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../troubleshooting/finding_nodes.html">Finding misbehaving nodes</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../troubleshooting/reading_logs.html">Reading Cassandra logs</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../troubleshooting/use_nodetool.html">Using nodetool</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../troubleshooting/use_tools.html">Using external tools to deep-dive</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../development/index.html">Development</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../development/gettingstarted.html">Getting started</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../development/ide.html">Building and IDE integration</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../development/testing.html">Testing</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../development/patches.html">Contributing code changes</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../development/code_style.html">Code style</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../development/how_to_review.html">Review checklist</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../development/how_to_commit.html">How to commit</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../development/documentation.html">Working on documentation</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../development/ci.html">Jenkins CI environment</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../development/dependencies.html">Dependency management</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../development/release_process.html">Release process</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../faq/index.html">FAQ</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/index.html">Plug-ins</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Cassandra</span>
    <span class="version">4.0-beta1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Cassandra</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="../../index.html">4.0-beta1</a>
        </li>
        <li class="version is-latest">
          <a href="../../../3.11/index.html">3.11</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li>Cassandra</li>
    <li><a href="index.html">Operating</a></li>
    <li><a href="backups.html">Backups</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">4.0-beta1</button>
  <div class="version-menu">
    <a class="version is-current" href="backups.html">4.0-beta1</a>
    <a class="version" href="../../../3.11/cassandra/operating/backups.html">3.11</a>
  </div>
</div>
  <div class="edit-this-page"><a href="file:///Users/lorina.poland/CLONES/cassandra/doc/source/modules/cassandra/pages/operating/backups.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<article class="doc">
<h1 class="page">Backups</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Apache Cassandra stores data in immutable SSTable files. Backups in
Apache Cassandra database are backup copies of the database data that is
stored as SSTable files. Backups are used for several purposes including
the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To store a data copy for durability</p>
</li>
<li>
<p>To be able to restore a table if table data is lost due to
node/partition/network failure</p>
</li>
<li>
<p>To be able to transfer the SSTable files to a different machine; for
portability</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="types-of-backups"><a class="anchor" href="#types-of-backups"></a>Types of Backups</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Apache Cassandra supports two kinds of backup strategies.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Snapshots</p>
</li>
<li>
<p>Incremental Backups</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A <em>snapshot</em> is a copy of a table’s SSTable files at a given time,
created via hard links. The DDL to create the table is stored as well.
Snapshots may be created by a user or created automatically. The setting
(<code>snapshot_before_compaction</code>) in <code>cassandra.yaml</code> determines if
snapshots are created before each compaction. By default
<code>snapshot_before_compaction</code> is set to false. Snapshots may be created
automatically before keyspace truncation or dropping of a table by
setting <code>auto_snapshot</code> to true (default) in <code>cassandra.yaml</code>. Truncates
could be delayed due to the auto snapshots and another setting in
<code>cassandra.yaml</code> determines how long the coordinator should wait for
truncates to complete. By default Cassandra waits 60 seconds for auto
snapshots to complete.</p>
</div>
<div class="paragraph">
<p>An <em>incremental backup</em> is a copy of a table’s SSTable files created by
a hard link when memtables are flushed to disk as SSTables. Typically
incremental backups are paired with snapshots to reduce the backup time
as well as reduce disk space. Incremental backups are not enabled by
default and must be enabled explicitly in <code>cassandra.yaml</code> (with
<code>incremental_backups</code> setting) or with the Nodetool. Once enabled,
Cassandra creates a hard link to each SSTable flushed or streamed
locally in a <code>backups/</code> subdirectory of the keyspace data. Incremental
backups of system tables are also created.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="data-directory-structure"><a class="anchor" href="#data-directory-structure"></a>Data Directory Structure</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The directory structure of Cassandra data consists of different
directories for keyspaces, and tables with the data files within the
table directories. Directories backups and snapshots to store backups
and snapshots respectively for a particular table are also stored within
the table directory. The directory structure for Cassandra is
illustrated in Figure 1.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/Figure_1_backups.jpg" alt="image">
</div>
</div>
<div class="paragraph">
<p>Figure 1. Directory Structure for Cassandra Data</p>
</div>
<div class="sect2">
<h3 id="setting-up-example-tables-for-backups-and-snapshots"><a class="anchor" href="#setting-up-example-tables-for-backups-and-snapshots"></a>Setting Up Example Tables for Backups and Snapshots</h3>
<div class="paragraph">
<p>In this section we shall create some example data that could be used to
demonstrate incremental backups and snapshots. We have used a three node
Cassandra cluster. First, the keyspaces are created. Subsequently tables
are created within a keyspace and table data is added. We have used two
keyspaces <code>CQLKeyspace</code> and <code>CatalogKeyspace</code> with two tables within
each. Create <code>CQLKeyspace</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cql hljs" data-lang="cql">CREATE KEYSPACE CQLKeyspace
  WITH replication = {'class': 'SimpleStrategy', 'replication_factor' : 3};</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create table <code>t</code> in the <code>CQLKeyspace</code> keyspace.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cql hljs" data-lang="cql">USE CQLKeyspace;
CREATE TABLE t (
   id int,
   k int,
   v text,
   PRIMARY KEY (id)
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add data to table <code>t</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cql hljs" data-lang="cql">INSERT INTO t (id, k, v) VALUES (0, 0, 'val0');
INSERT INTO t (id, k, v) VALUES (1, 1, 'val1');</code></pre>
</div>
</div>
<div class="paragraph">
<p>A table query lists the data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cql hljs" data-lang="cql">SELECT * FROM t;</code></pre>
</div>
</div>
<div class="paragraph">
<p>results in</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cql hljs" data-lang="cql">id | k | v
----+---+------
 1 | 1 | val1
 0 | 0 | val0

 (2 rows)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create another table <code>t2</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cql hljs" data-lang="cql">CREATE TABLE t2 (
   id int,
   k int,
   v text,
   PRIMARY KEY (id)
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add data to table <code>t2</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cql hljs" data-lang="cql">INSERT INTO t2 (id, k, v) VALUES (0, 0, 'val0');
INSERT INTO t2 (id, k, v) VALUES (1, 1, 'val1');
INSERT INTO t2 (id, k, v) VALUES (2, 2, 'val2');</code></pre>
</div>
</div>
<div class="paragraph">
<p>A table query lists table data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cql hljs" data-lang="cql">SELECT * FROM t2;</code></pre>
</div>
</div>
<div class="paragraph">
<p>results in</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cql hljs" data-lang="cql">id | k | v
----+---+------
 1 | 1 | val1
 0 | 0 | val0
 2 | 2 | val2

 (3 rows)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create a second keyspace <code>CatalogKeyspace</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cql hljs" data-lang="cql">CREATE KEYSPACE CatalogKeyspace
   WITH replication = {'class': 'SimpleStrategy', 'replication_factor' : 3};</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create a table called <code>journal</code> in <code>CatalogKeyspace</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cql hljs" data-lang="cql">USE CatalogKeyspace;
CREATE TABLE journal (
   id int,
   name text,
   publisher text,
   PRIMARY KEY (id)
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add data to table <code>journal</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cql hljs" data-lang="cql">INSERT INTO journal (id, name, publisher) VALUES (0, 'Apache Cassandra Magazine', 'Apache Cassandra');
INSERT INTO journal (id, name, publisher) VALUES (1, 'Couchbase Magazine', 'Couchbase');</code></pre>
</div>
</div>
<div class="paragraph">
<p>Query table <code>journal</code> to list its data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cql hljs" data-lang="cql">SELECT * FROM journal;</code></pre>
</div>
</div>
<div class="paragraph">
<p>results in</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cql hljs" data-lang="cql">id | name                      | publisher
----+---------------------------+------------------
 1 |        Couchbase Magazine |        Couchbase
 0 | Apache Cassandra Magazine | Apache Cassandra

 (2 rows)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add another table called <code>magazine</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cql hljs" data-lang="cql">CREATE TABLE magazine (
   id int,
   name text,
   publisher text,
   PRIMARY KEY (id)
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add table data to <code>magazine</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cql hljs" data-lang="cql">INSERT INTO magazine (id, name, publisher) VALUES (0, 'Apache Cassandra Magazine', 'Apache Cassandra');
INSERT INTO magazine (id, name, publisher) VALUES (1, 'Couchbase Magazine', 'Couchbase');</code></pre>
</div>
</div>
<div class="paragraph">
<p>List table <code>magazine</code>’s data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cql hljs" data-lang="cql">SELECT * from magazine;</code></pre>
</div>
</div>
<div class="paragraph">
<p>results in</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cql hljs" data-lang="cql">id | name                      | publisher
----+---------------------------+------------------
 1 |        Couchbase Magazine |        Couchbase
 0 | Apache Cassandra Magazine | Apache Cassandra

 (2 rows)</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="snapshots"><a class="anchor" href="#snapshots"></a>Snapshots</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this section including sub-sections we shall demonstrate creating
snapshots. The command used to create a snapshot is <code>nodetool snapshot</code>
and its usage is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ nodetool help snapshot</code></pre>
</div>
</div>
<div class="paragraph">
<p>results in</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">NAME
       nodetool snapshot - Take a snapshot of specified keyspaces or a snapshot
       of the specified table

SYNOPSIS
       nodetool [(-h &lt;host&gt; | --host &lt;host&gt;)] [(-p &lt;port&gt; | --port &lt;port&gt;)]
               [(-pp | --print-port)] [(-pw &lt;password&gt; | --password &lt;password&gt;)]
               [(-pwf &lt;passwordFilePath&gt; | --password-file &lt;passwordFilePath&gt;)]
               [(-u &lt;username&gt; | --username &lt;username&gt;)] snapshot
               [(-cf &lt;table&gt; | --column-family &lt;table&gt; | --table &lt;table&gt;)]
               [(-kt &lt;ktlist&gt; | --kt-list &lt;ktlist&gt; | -kc &lt;ktlist&gt; | --kc.list &lt;ktlist&gt;)]
               [(-sf | --skip-flush)] [(-t &lt;tag&gt; | --tag &lt;tag&gt;)] [--] [&lt;keyspaces...&gt;]

OPTIONS
       -cf &lt;table&gt;, --column-family &lt;table&gt;, --table &lt;table&gt;
           The table name (you must specify one and only one keyspace for using
           this option)

       -h &lt;host&gt;, --host &lt;host&gt;
           Node hostname or ip address

       -kt &lt;ktlist&gt;, --kt-list &lt;ktlist&gt;, -kc &lt;ktlist&gt;, --kc.list &lt;ktlist&gt;
           The list of Keyspace.table to take snapshot.(you must not specify
           only keyspace)

       -p &lt;port&gt;, --port &lt;port&gt;
           Remote jmx agent port number

       -pp, --print-port
           Operate in 4.0 mode with hosts disambiguated by port number

       -pw &lt;password&gt;, --password &lt;password&gt;
           Remote jmx agent password

       -pwf &lt;passwordFilePath&gt;, --password-file &lt;passwordFilePath&gt;
           Path to the JMX password file

       -sf, --skip-flush
           Do not flush memtables before snapshotting (snapshot will not
           contain unflushed data)

       -t &lt;tag&gt;, --tag &lt;tag&gt;
           The name of the snapshot

       -u &lt;username&gt;, --username &lt;username&gt;
           Remote jmx agent username

       --
           This option can be used to separate command-line options from the
           list of argument, (useful when arguments might be mistaken for
           command-line options

       [&lt;keyspaces...&gt;]
           List of keyspaces. By default, all keyspaces</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="configuring-for-snapshots"><a class="anchor" href="#configuring-for-snapshots"></a>Configuring for Snapshots</h3>
<div class="paragraph">
<p>To demonstrate creating snapshots with Nodetool on the commandline we
have set <code>auto_snapshots</code> setting to <code>false</code> in <code>cassandra.yaml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">auto_snapshot: false</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also set <code>snapshot_before_compaction</code> to <code>false</code> to disable creating
snapshots automatically before compaction:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">snapshot_before_compaction: false</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="creating-snapshots"><a class="anchor" href="#creating-snapshots"></a>Creating Snapshots</h3>
<div class="paragraph">
<p>To demonstrate creating snapshots start with no snapshots. Search for
snapshots and none get listed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ find -name snapshots</code></pre>
</div>
</div>
<div class="paragraph">
<p>We shall be using the example keyspaces and tables to create snapshots.</p>
</div>
<div class="sect3">
<h4 id="taking-snapshots-of-all-tables-in-a-keyspace"><a class="anchor" href="#taking-snapshots-of-all-tables-in-a-keyspace"></a>Taking Snapshots of all Tables in a Keyspace</h4>
<div class="paragraph">
<p>To take snapshots of all tables in a keyspace and also optionally tag
the snapshot the syntax becomes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ nodetool snapshot --tag &lt;tag&gt;  --&lt;keyspace&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>As an example create a snapshot called <code>catalog-ks</code> for all the tables
in the <code>catalogkeyspace</code> keyspace:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ nodetool snapshot --tag catalog-ks -- catalogkeyspace</code></pre>
</div>
</div>
<div class="paragraph">
<p>results in</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">Requested creating snapshot(s) for [catalogkeyspace] with snapshot name [catalog-ks] and
options {skipFlush=false}
Snapshot directory: catalog-ks</code></pre>
</div>
</div>
<div class="paragraph">
<p>Search for snapshots and <code>snapshots</code> directories for the tables
<code>journal</code> and <code>magazine</code>, which are in the <code>catalogkeyspace</code> keyspace
should get listed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ find -name snapshots</code></pre>
</div>
</div>
<div class="paragraph">
<p>results in</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">./cassandra/data/data/catalogkeyspace/journal-296a2d30c22a11e9b1350d927649052c/snapshots
./cassandra/data/data/catalogkeyspace/magazine-446eae30c22a11e9b1350d927649052c/snapshots</code></pre>
</div>
</div>
<div class="paragraph">
<p>Snapshots of all tables in multiple keyspaces may be created similarly,
as an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ nodetool snapshot --tag catalog-cql-ks --catalogkeyspace,cqlkeyspace</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="taking-snapshots-of-single-table-in-a-keyspace"><a class="anchor" href="#taking-snapshots-of-single-table-in-a-keyspace"></a>Taking Snapshots of Single Table in a Keyspace</h4>
<div class="paragraph">
<p>To take a snapshot of a single table the <code>nodetool snapshot</code> command
syntax becomes as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ nodetool snapshot --tag &lt;tag&gt; --table &lt;table&gt;  --&lt;keyspace&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>As an example create a snapshot for table <code>magazine</code> in keyspace
<code>catalokeyspace</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ nodetool snapshot --tag magazine --table magazine  --catalogkeyspace</code></pre>
</div>
</div>
<div class="paragraph">
<p>results in</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">Requested creating snapshot(s) for [catalogkeyspace] with snapshot name [magazine] and
options {skipFlush=false}
Snapshot directory: magazine</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="taking-snapshot-of-multiple-tables-from-same-keyspace"><a class="anchor" href="#taking-snapshot-of-multiple-tables-from-same-keyspace"></a>Taking Snapshot of Multiple Tables from same Keyspace</h4>
<div class="paragraph">
<p>To take snapshots of multiple tables in a keyspace the list of
<em>Keyspace.table</em> must be specified with option <code>--kt-list</code>. As an
example create snapshots for tables <code>t</code> and <code>t2</code> in the <code>cqlkeyspace</code>
keyspace:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$nodetool snapshot --kt-list cqlkeyspace.t,cqlkeyspace.t2 --tag multi-table</code></pre>
</div>
</div>
<div class="paragraph">
<p>results in</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">Requested creating snapshot(s) for [cqlkeyspace.t,cqlkeyspace.t2] with snapshot name [multi-
table] and options {skipFlush=false}
Snapshot directory: multi-table</code></pre>
</div>
</div>
<div class="paragraph">
<p>Multiple snapshots of the same set of tables may be created and tagged
with a different name. As an example, create another snapshot for the
same set of tables <code>t</code> and <code>t2</code> in the <code>cqlkeyspace</code> keyspace and tag
the snapshots differently:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ nodetool snapshot --kt-list cqlkeyspace.t,cqlkeyspace.t2 --tag
multi-table-2</code></pre>
</div>
</div>
<div class="paragraph">
<p>results in</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">Requested creating snapshot(s) for [cqlkeyspace.t,cqlkeyspace.t2] with snapshot name [multi-
table-2] and options {skipFlush=false}
Snapshot directory: multi-table-2</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="taking-snapshot-of-multiple-tables-from-different-keyspaces"><a class="anchor" href="#taking-snapshot-of-multiple-tables-from-different-keyspaces"></a>Taking Snapshot of Multiple Tables from Different Keyspaces</h4>
<div class="paragraph">
<p>To take snapshots of multiple tables that are in different keyspaces the
command syntax is the same as when multiple tables are in the same
keyspace. Each <em>keyspace.table</em> must be specified separately in the
<code>--kt-list</code> option. As an example, create a snapshot for table <code>t</code> in
the <code>cqlkeyspace</code> and table <code>journal</code> in the catalogkeyspace and tag the
snapshot <code>multi-ks</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ nodetool snapshot --kt-list catalogkeyspace.journal,cqlkeyspace.t --tag multi-ks</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">Requested creating snapshot(s) for [catalogkeyspace.journal,cqlkeyspace.t] with snapshot
name [multi-ks] and options {skipFlush=false}
Snapshot directory: multi-ks</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="listing-snapshots"><a class="anchor" href="#listing-snapshots"></a>Listing Snapshots</h3>
<div class="paragraph">
<p>To list snapshots use the <code>nodetool listsnapshots</code> command. All the
snapshots that we created in the preceding examples get listed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ nodetool listsnapshots</code></pre>
</div>
</div>
<div class="paragraph">
<p>results in</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">Snapshot Details:
Snapshot name Keyspace name   Column family name True size Size on disk
multi-table   cqlkeyspace     t2                 4.86 KiB  5.67 KiB
multi-table   cqlkeyspace     t                  4.89 KiB  5.7 KiB
multi-ks      cqlkeyspace     t                  4.89 KiB  5.7 KiB
multi-ks      catalogkeyspace journal            4.9 KiB   5.73 KiB
magazine      catalogkeyspace magazine           4.9 KiB   5.73 KiB
multi-table-2 cqlkeyspace     t2                 4.86 KiB  5.67 KiB
multi-table-2 cqlkeyspace     t                  4.89 KiB  5.7 KiB
catalog-ks    catalogkeyspace journal            4.9 KiB   5.73 KiB
catalog-ks    catalogkeyspace magazine           4.9 KiB   5.73 KiB

Total TrueDiskSpaceUsed: 44.02 KiB</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="finding-snapshots-directories"><a class="anchor" href="#finding-snapshots-directories"></a>Finding Snapshots Directories</h3>
<div class="paragraph">
<p>The <code>snapshots</code> directories may be listed with <code>find –name snapshots</code>
command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ find -name snapshots</code></pre>
</div>
</div>
<div class="paragraph">
<p>results in</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">./cassandra/data/data/cqlkeyspace/t-d132e240c21711e9bbee19821dcea330/snapshots
./cassandra/data/data/cqlkeyspace/t2-d993a390c22911e9b1350d927649052c/snapshots
./cassandra/data/data/catalogkeyspace/journal-296a2d30c22a11e9b1350d927649052c/snapshots
./cassandra/data/data/catalogkeyspace/magazine-446eae30c22a11e9b1350d927649052c/snapshots
[ec2-user@ip-10-0-2-238 ~]$</code></pre>
</div>
</div>
<div class="paragraph">
<p>To list the snapshots for a particular table first change directory (
with <code>cd</code>) to the <code>snapshots</code> directory for the table. As an example,
list the snapshots for the <code>catalogkeyspace/journal</code> table. Two
snapshots get listed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ cd ./cassandra/data/data/catalogkeyspace/journal-296a2d30c22a11e9b1350d927649052c/snapshots
$ ls -l</code></pre>
</div>
</div>
<div class="paragraph">
<p>results in</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">total 0
drwxrwxr-x. 2 ec2-user ec2-user 265 Aug 19 02:44 catalog-ks
drwxrwxr-x. 2 ec2-user ec2-user 265 Aug 19 02:52 multi-ks</code></pre>
</div>
</div>
<div class="paragraph">
<p>A <code>snapshots</code> directory lists the SSTable files in the snapshot.
<code>Schema.cql</code> file is also created in each snapshot for the schema
definition DDL that may be run in CQL to create the table when restoring
from a snapshot:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd catalog-ks
$ ls -l</code></pre>
</div>
</div>
<div class="paragraph">
<p>results in</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">total 44
-rw-rw-r--. 1 ec2-user ec2-user   31 Aug 19 02:44 manifest.jsonZ

-rw-rw-r--. 4 ec2-user ec2-user   47 Aug 19 02:38 na-1-big-CompressionInfo.db
-rw-rw-r--. 4 ec2-user ec2-user   97 Aug 19 02:38 na-1-big-Data.db
-rw-rw-r--. 4 ec2-user ec2-user   10 Aug 19 02:38 na-1-big-Digest.crc32
-rw-rw-r--. 4 ec2-user ec2-user   16 Aug 19 02:38 na-1-big-Filter.db
-rw-rw-r--. 4 ec2-user ec2-user   16 Aug 19 02:38 na-1-big-Index.db
-rw-rw-r--. 4 ec2-user ec2-user 4687 Aug 19 02:38 na-1-big-Statistics.db
-rw-rw-r--. 4 ec2-user ec2-user   56 Aug 19 02:38 na-1-big-Summary.db
-rw-rw-r--. 4 ec2-user ec2-user   92 Aug 19 02:38 na-1-big-TOC.txt
-rw-rw-r--. 1 ec2-user ec2-user  814 Aug 19 02:44 schema.cql</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="clearing-snapshots"><a class="anchor" href="#clearing-snapshots"></a>Clearing Snapshots</h3>
<div class="paragraph">
<p>Snapshots may be cleared or deleted with the <code>nodetool clearsnapshot</code>
command. Either a specific snapshot name must be specified or the <code>–all</code>
option must be specified. As an example delete a snapshot called
<code>magazine</code> from keyspace <code>cqlkeyspace</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ nodetool clearsnapshot -t magazine – cqlkeyspace</code></pre>
</div>
</div>
<div class="paragraph">
<p>or delete all snapshots from cqlkeyspace with the –all option:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">nodetool clearsnapshot –all -- cqlkeyspace</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="incremental-backups"><a class="anchor" href="#incremental-backups"></a>Incremental Backups</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the following sub-sections we shall discuss configuring and creating
incremental backups.</p>
</div>
<div class="sect2">
<h3 id="configuring-for-incremental-backups"><a class="anchor" href="#configuring-for-incremental-backups"></a>Configuring for Incremental Backups</h3>
<div class="paragraph">
<p>To create incremental backups set <code>incremental_backups</code> to <code>true</code> in
<code>cassandra.yaml</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">incremental_backups: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is the only setting needed to create incremental backups. By
default <code>incremental_backups</code> setting is set to <code>false</code> because a new
set of SSTable files is created for each data flush and if several CQL
statements are to be run the <code>backups</code> directory could fill up quickly
and use up storage that is needed to store table data. Incremental
backups may also be enabled on the command line with the Nodetool
command <code>nodetool enablebackup</code>. Incremental backups may be disabled
with <code>nodetool disablebackup</code> command. Status of incremental backups,
whether they are enabled may be found with <code>nodetool statusbackup</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="creating-incremental-backups"><a class="anchor" href="#creating-incremental-backups"></a>Creating Incremental Backups</h3>
<div class="paragraph">
<p>After each table is created flush the table data with <code>nodetool flush</code>
command. Incremental backups get created.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ nodetool flush cqlkeyspace t
$ nodetool flush cqlkeyspace t2
$ nodetool flush catalogkeyspace journal magazine</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="finding-incremental-backups"><a class="anchor" href="#finding-incremental-backups"></a>Finding Incremental Backups</h3>
<div class="paragraph">
<p>Incremental backups are created within the Cassandra’s <code>data</code> directory
within a table directory. Backups may be found with following command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ find -name backups</code></pre>
</div>
</div>
<div class="paragraph">
<p>results in</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">./cassandra/data/data/cqlkeyspace/t-d132e240c21711e9bbee19821dcea330/backups
./cassandra/data/data/cqlkeyspace/t2-d993a390c22911e9b1350d927649052c/backups
./cassandra/data/data/catalogkeyspace/journal-296a2d30c22a11e9b1350d927649052c/backups
./cassandra/data/data/catalogkeyspace/magazine-446eae30c22a11e9b1350d927649052c/backups</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="creating-an-incremental-backup"><a class="anchor" href="#creating-an-incremental-backup"></a>Creating an Incremental Backup</h3>
<div class="paragraph">
<p>This section discusses how incremental backups are created in more
detail starting with when a new keyspace is created and a table is
added. Create a keyspace called <code>CQLKeyspace</code> (arbitrary name).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cql hljs" data-lang="cql">CREATE KEYSPACE CQLKeyspace
   WITH replication = {'class': 'SimpleStrategy', 'replication_factor' : 3}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create a table called <code>t</code> within the <code>CQLKeyspace</code> keyspace:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cql hljs" data-lang="cql">USE CQLKeyspace;
CREATE TABLE t (
   id int,
   k int,
   v text,
   PRIMARY KEY (id)
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Flush the keyspace and table:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ nodetool flush cqlkeyspace t</code></pre>
</div>
</div>
<div class="paragraph">
<p>Search for backups and a <code>backups</code> directory should get listed even
though we have added no table data yet.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ find -name backups</code></pre>
</div>
</div>
<div class="paragraph">
<p>results in</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">./cassandra/data/data/cqlkeyspace/t-d132e240c21711e9bbee19821dcea330/backups</code></pre>
</div>
</div>
<div class="paragraph">
<p>Change directory to the <code>backups</code> directory and list files and no files
get listed as no table data has been added yet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ cd ./cassandra/data/data/cqlkeyspace/t-d132e240c21711e9bbee19821dcea330/backups
$ ls -l</code></pre>
</div>
</div>
<div class="paragraph">
<p>results in</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">total 0</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, add a row of data to table <code>t</code> that we created:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cql hljs" data-lang="cql">INSERT INTO t (id, k, v) VALUES (0, 0, 'val0');</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run the <code>nodetool flush</code> command to flush table data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ nodetool flush cqlkeyspace t</code></pre>
</div>
</div>
<div class="paragraph">
<p>List the files and directories in the <code>backups</code> directory and SSTable
files for an incremental backup get listed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ cd ./cassandra/data/data/cqlkeyspace/t-d132e240c21711e9bbee19821dcea330/backups
$ ls -l</code></pre>
</div>
</div>
<div class="paragraph">
<p>results in</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">total 36
-rw-rw-r--. 2 ec2-user ec2-user   47 Aug 19 00:32 na-1-big-CompressionInfo.db
-rw-rw-r--. 2 ec2-user ec2-user   43 Aug 19 00:32 na-1-big-Data.db
-rw-rw-r--. 2 ec2-user ec2-user   10 Aug 19 00:32 na-1-big-Digest.crc32
-rw-rw-r--. 2 ec2-user ec2-user   16 Aug 19 00:32 na-1-big-Filter.db
-rw-rw-r--. 2 ec2-user ec2-user    8 Aug 19 00:32 na-1-big-Index.db
-rw-rw-r--. 2 ec2-user ec2-user 4673 Aug 19 00:32 na-1-big-Statistics.db
-rw-rw-r--. 2 ec2-user ec2-user   56 Aug 19 00:32 na-1-big-Summary.db
-rw-rw-r--. 2 ec2-user ec2-user   92 Aug 19 00:32 na-1-big-TOC.txt</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add another row of data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cql hljs" data-lang="cql">INSERT INTO t (id, k, v) VALUES (1, 1, 'val1');</code></pre>
</div>
</div>
<div class="paragraph">
<p>Again, run the <code>nodetool flush</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$  nodetool flush cqlkeyspace t</code></pre>
</div>
</div>
<div class="paragraph">
<p>A new incremental backup gets created for the new data added. List the
files in the <code>backups</code> directory for table <code>t</code> and two sets of SSTable
files get listed, one for each incremental backup. The SSTable files are
timestamped, which distinguishes the first incremental backup from the
second:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ls -l</code></pre>
</div>
</div>
<div class="paragraph">
<p>results in</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">total 72
-rw-rw-r--. 2 ec2-user ec2-user   47 Aug 19 00:32 na-1-big-CompressionInfo.db
-rw-rw-r--. 2 ec2-user ec2-user   43 Aug 19 00:32 na-1-big-Data.db
-rw-rw-r--. 2 ec2-user ec2-user   10 Aug 19 00:32 na-1-big-Digest.crc32
-rw-rw-r--. 2 ec2-user ec2-user   16 Aug 19 00:32 na-1-big-Filter.db
-rw-rw-r--. 2 ec2-user ec2-user    8 Aug 19 00:32 na-1-big-Index.db
-rw-rw-r--. 2 ec2-user ec2-user 4673 Aug 19 00:32 na-1-big-Statistics.db
-rw-rw-r--. 2 ec2-user ec2-user   56 Aug 19 00:32 na-1-big-Summary.db
-rw-rw-r--. 2 ec2-user ec2-user   92 Aug 19 00:32 na-1-big-TOC.txt
-rw-rw-r--. 2 ec2-user ec2-user   47 Aug 19 00:35 na-2-big-CompressionInfo.db
-rw-rw-r--. 2 ec2-user ec2-user   41 Aug 19 00:35 na-2-big-Data.db
-rw-rw-r--. 2 ec2-user ec2-user   10 Aug 19 00:35 na-2-big-Digest.crc32
-rw-rw-r--. 2 ec2-user ec2-user   16 Aug 19 00:35 na-2-big-Filter.db
-rw-rw-r--. 2 ec2-user ec2-user    8 Aug 19 00:35 na-2-big-Index.db
-rw-rw-r--. 2 ec2-user ec2-user 4673 Aug 19 00:35 na-2-big-Statistics.db
-rw-rw-r--. 2 ec2-user ec2-user   56 Aug 19 00:35 na-2-big-Summary.db
-rw-rw-r--. 2 ec2-user ec2-user   92 Aug 19 00:35 na-2-big-TOC.txt</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>backups</code> directory for table <code>cqlkeyspace/t</code> is created within the
<code>data</code> directory for the table:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ cd ./cassandra/data/data/cqlkeyspace/t-d132e240c21711e9bbee19821dcea330 &amp;&amp; ls -l</code></pre>
</div>
</div>
<div class="paragraph">
<p>results in</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">total 36
drwxrwxr-x. 2 ec2-user ec2-user  226 Aug 19 02:30 backups
-rw-rw-r--. 2 ec2-user ec2-user   47 Aug 19 02:30 na-1-big-CompressionInfo.db
-rw-rw-r--. 2 ec2-user ec2-user   79 Aug 19 02:30 na-1-big-Data.db
-rw-rw-r--. 2 ec2-user ec2-user   10 Aug 19 02:30 na-1-big-Digest.crc32
-rw-rw-r--. 2 ec2-user ec2-user   16 Aug 19 02:30 na-1-big-Filter.db
-rw-rw-r--. 2 ec2-user ec2-user   16 Aug 19 02:30 na-1-big-Index.db
-rw-rw-r--. 2 ec2-user ec2-user 4696 Aug 19 02:30 na-1-big-Statistics.db
-rw-rw-r--. 2 ec2-user ec2-user   56 Aug 19 02:30 na-1-big-Summary.db
-rw-rw-r--. 2 ec2-user ec2-user   92 Aug 19 02:30 na-1-big-TOC.txt</code></pre>
</div>
</div>
<div class="paragraph">
<p>The incremental backups for the other keyspaces/tables get created
similarly. As an example the <code>backups</code> directory for table
<code>catalogkeyspace/magazine</code> is created within the data directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">$ cd ./cassandra/data/data/catalogkeyspace/magazine-446eae30c22a11e9b1350d927649052c &amp;&amp; ls -l</code></pre>
</div>
</div>
<div class="paragraph">
<p>results in</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">total 36
drwxrwxr-x. 2 ec2-user ec2-user  226 Aug 19 02:38 backups
-rw-rw-r--. 2 ec2-user ec2-user   47 Aug 19 02:38 na-1-big-CompressionInfo.db
-rw-rw-r--. 2 ec2-user ec2-user   97 Aug 19 02:38 na-1-big-Data.db
-rw-rw-r--. 2 ec2-user ec2-user   10 Aug 19 02:38 na-1-big-Digest.crc32
-rw-rw-r--. 2 ec2-user ec2-user   16 Aug 19 02:38 na-1-big-Filter.db
-rw-rw-r--. 2 ec2-user ec2-user   16 Aug 19 02:38 na-1-big-Index.db
-rw-rw-r--. 2 ec2-user ec2-user 4687 Aug 19 02:38 na-1-big-Statistics.db
-rw-rw-r--. 2 ec2-user ec2-user   56 Aug 19 02:38 na-1-big-Summary.db
-rw-rw-r--. 2 ec2-user ec2-user   92 Aug 19 02:38 na-1-big-TOC.txt</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="restoring-from-incremental-backups-and-snapshots"><a class="anchor" href="#restoring-from-incremental-backups-and-snapshots"></a>Restoring from Incremental Backups and Snapshots</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The two main tools/commands for restoring a table after it has been
dropped are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>sstableloader</p>
</li>
<li>
<p>nodetool import</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A snapshot contains essentially the same set of SSTable files as an
incremental backup does with a few additional files. A snapshot includes
a <code>schema.cql</code> file for the schema DDL to create a table in CQL. A table
backup does not include DDL which must be obtained from a snapshot when
restoring from an incremental backup.</p>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="3">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p> © 2020 <a href="https://apache.org">The Apache Software Foundation.</a> Apache, the Apache feather logo, and Apache Cassandra are trademarks of The Apache Software Foundation.
   <a href="https://twitter.com/cassandra"
           class="twitter-follow-button"
           data-show-count="false" data-size="large">Follow @cassandra</a>
           <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
  <a href="https://twitter.com/intent/tweet?button_hashtag=cassandra"
           class="twitter-hashtag-button"
           data-size="large"
           data-related="ApacheCassandra">Tweet #cassandra</a>
  <a class="subscribe-rss" href="/feed.xml" title="Subscribe to Blog via RSS"><img src="../../../../_/img/Feed-icon.svg"></a>
  </p>
</footer>
<script>
  window.antora = window.antora || {}
  window.antora.basePath = '../../../..'
  window.antora.pagePath = '/Cassandra/4.0/cassandra/operating/backups.html'
</script>
<script src="../../../../_/js/site.js"></script>
<script src="../../../../_/js/vendor/lunr.js"></script>
<script src="../../../../_/js/vendor/search.js"></script>
<script async src="../../../../_/../search-index.js"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
<!-- Javascript. Placed here so pages load faster -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="js/underscore-min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
  </body>
</html>
