<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Audit Logging :: Apache Cassandra Documentation</title>
    <meta name="generator" content="Antora 2.3.1">
    <link rel="stylesheet" href="../../../../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../../..">Apache Cassandra Documentation&nbsp;&nbsp;&nbsp;<img src="../../../../_/img/cassandra_logo.png"></a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Download</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Latest</a>
            <a class="navbar-item" href="#">3.x</a>
            <a class="navbar-item" href="#">3.0</a>
            <a class="navbar-item" href="#">2.1</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Documentation</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Latest</a>
            <a class="navbar-item" href="#">3.x</a>
            <a class="navbar-item" href="#">3.0</a>
            <a class="navbar-item" href="#">2.1</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Community</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Developer Mailing List</a>
            <a class="navbar-item" href="#">User Mailing List</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Blog</a>
	</div>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="ASCIIDOC_POC" data-version="4.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../index.html">ASCIIDOC_POC</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../index.html">Cassandra Documentation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../glossary.html">Glossary</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../bugs.html">How to report bugs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../contactus.html">Contact us</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Cassandra</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../architecture/index.html">Architecture</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../architecture/overview.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../architecture/dynamo.html">Dynamo</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../architecture/storage_engine.html">Storage engine</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../architecture/guarantees.html">Guarantees</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html">What&#8217;s new</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../getting_started/index.html">Getting Started</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../getting_started/installing.html">Installing Cassandra</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../getting_started/configuring.html">Configuring Cassandra</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../getting_started/querying.html">Inserting and querying</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../getting_started/drivers.html">Client drivers</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../getting_started/production.html">Production recommendations</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../data_modeling/index.html">Data Modeling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#cql/index.adoc{">CQL</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/changes.html">Changes</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/ddl.html">DDL</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/dml.html">DML</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/types.html">Data types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/operators.html">Operators</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/definitions.html">Definitions</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/indexes.html">Secondary indexes</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/mvs.html">Materialized views</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/functions.html">Functions</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/json.html">JSON</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/security.html">Security</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/triggers.html">Triggers</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/appendices.html">Appendices</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/index.html">Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operating/index.html">Operating</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tools/index.html">Tools</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../development/index.html">Development</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/index.html">Plug-ins</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../troubleshooting/index.html">Troubleshooting</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../faq/index.html">FAQ</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">ASCIIDOC_POC</span>
    <span class="version">4.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">ASCIIDOC_POC</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../index.html">4.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../index.html">ASCIIDOC_POC</a></li>
    <li><a href="auditlogging.html">Audit Logging</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///Users/lorina.poland/CLONES/cassandra-examples/rst-to-asciidoc-tests/ASCIIDOC/modules/cassandra/pages/new/auditlogging.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<article class="doc">
<h1 class="page">Audit Logging</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Audit Logging is a new feature in Apache Cassandra 4.0
(<a href="https://issues.apache.org/jira/browse/CASSANDRA-12151">CASSANDRA-12151</a>).
All database activity is logged to a directory in the local filesystem
and the audit log files are rolled periodically. All database operations
are monitored and recorded. Audit logs are stored in local directory
files instead of the database itself as it provides several benefits,
some of which are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>No additional database capacity is needed to store audit logs</p>
</li>
<li>
<p>No query tool is required while storing the audit logs in the database
would require a query tool</p>
</li>
<li>
<p>Latency of database operations is not affected; no performance impact</p>
</li>
<li>
<p>It is easier to implement file based logging than database based
logging</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="what-does-audit-logging-log"><a class="anchor" href="#what-does-audit-logging-log"></a>What does Audit Logging Log?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Audit logging logs:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>All authentication which includes successful and failed login attempts</p>
</li>
<li>
<p>All database command requests to CQL. Both failed and successful CQL
is logged</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>More specifically an audit log entry could be one of two types:</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>CQL Audit Log Entry Type or</p>
</li>
<li>
<p>Common Audit Log Entry Type</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Each of these types comprises of several database operations. The CQL
Audit Log Entry Type could be one of the following; the category of the
CQL audit log entry type is listed in parentheses.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>SELECT(QUERY),</p>
</li>
<li>
<p>UPDATE(DML),</p>
</li>
<li>
<p>DELETE(DML),</p>
</li>
<li>
<p>TRUNCATE(DDL),</p>
</li>
<li>
<p>CREATE_KEYSPACE(DDL),</p>
</li>
<li>
<p>ALTER_KEYSPACE(DDL),</p>
</li>
<li>
<p>DROP_KEYSPACE(DDL),</p>
</li>
<li>
<p>CREATE_TABLE(DDL),</p>
</li>
<li>
<p>DROP_TABLE(DDL),</p>
</li>
<li>
<p>PREPARE_STATEMENT(PREPARE),</p>
</li>
<li>
<p>DROP_TRIGGER(DDL),</p>
</li>
<li>
<p>LIST_USERS(DCL),</p>
</li>
<li>
<p>CREATE_INDEX(DDL),</p>
</li>
<li>
<p>DROP_INDEX(DDL),</p>
</li>
<li>
<p>GRANT(DCL),</p>
</li>
<li>
<p>REVOKE(DCL),</p>
</li>
<li>
<p>CREATE_TYPE(DDL),</p>
</li>
<li>
<p>DROP_AGGREGATE(DDL),</p>
</li>
<li>
<p>ALTER_VIEW(DDL),</p>
</li>
<li>
<p>CREATE_VIEW(DDL),</p>
</li>
<li>
<p>DROP_ROLE(DCL),</p>
</li>
<li>
<p>CREATE_FUNCTION(DDL),</p>
</li>
<li>
<p>ALTER_TABLE(DDL),</p>
</li>
<li>
<p>BATCH(DML),</p>
</li>
<li>
<p>CREATE_AGGREGATE(DDL),</p>
</li>
<li>
<p>DROP_VIEW(DDL),</p>
</li>
<li>
<p>DROP_TYPE(DDL),</p>
</li>
<li>
<p>DROP_FUNCTION(DDL),</p>
</li>
<li>
<p>ALTER_ROLE(DCL),</p>
</li>
<li>
<p>CREATE_TRIGGER(DDL),</p>
</li>
<li>
<p>LIST_ROLES(DCL),</p>
</li>
<li>
<p>LIST_PERMISSIONS(DCL),</p>
</li>
<li>
<p>ALTER_TYPE(DDL),</p>
</li>
<li>
<p>CREATE_ROLE(DCL),</p>
</li>
<li>
<p>USE_KEYSPACE (OTHER).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The Common Audit Log Entry Type could be one of the following; the
category of the Common audit log entry type is listed in parentheses.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>REQUEST_FAILURE(ERROR),</p>
</li>
<li>
<p>LOGIN_ERROR(AUTH),</p>
</li>
<li>
<p>UNAUTHORIZED_ATTEMPT(AUTH),</p>
</li>
<li>
<p>LOGIN_SUCCESS (AUTH).</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="what-audit-logging-does-not-log"><a class="anchor" href="#what-audit-logging-does-not-log"></a>What Audit Logging does not Log?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Audit logging does not log:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Configuration changes made in <code>cassandra.yaml</code></p>
</li>
<li>
<p>Nodetool Commands</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="audit-logging-is-flexible-and-configurable"><a class="anchor" href="#audit-logging-is-flexible-and-configurable"></a>Audit Logging is Flexible and Configurable</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Audit logging is flexible and configurable in <code>cassandra.yaml</code> as
follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Keyspaces and tables to be monitored and audited may be specified.</p>
</li>
<li>
<p>Users to be included/excluded may be specified. By default all users
are audit logged.</p>
</li>
<li>
<p>Categories of operations to audit or exclude may be specified.</p>
</li>
<li>
<p>The frequency at which to roll the log files may be specified. Default
frequency is hourly.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring-audit-logging"><a class="anchor" href="#configuring-audit-logging"></a>Configuring Audit Logging</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Audit Logging is configured on each node separately. Audit Logging is
configured in <code>cassandra.yaml</code> in the <code>audit_logging_options</code> setting.
The settings may be same/different on each node.</p>
</div>
<div class="sect2">
<h3 id="enabling-audit-logging"><a class="anchor" href="#enabling-audit-logging"></a>Enabling Audit Logging</h3>
<div class="paragraph">
<p>Audit logging is enabled by setting the <code>enabled</code> option to <code>true</code> in
the <code>audit_logging_options</code> setting.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>audit_logging_options:
   enabled: true</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="setting-the-logger"><a class="anchor" href="#setting-the-logger"></a>Setting the Logger</h3>
<div class="paragraph">
<p>The audit logger is set with the <code>logger</code> option.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>logger: BinAuditLogger</pre>
</div>
</div>
<div class="paragraph">
<p>Two types of audit loggers are supported: <code>FileAuditLogger</code> and
<code>BinAuditLogger</code>. <code>BinAuditLogger</code> is the default setting. The
<code>BinAuditLogger</code> is an efficient way to log events to file in a binary
format.</p>
</div>
<div class="paragraph">
<p><code>FileAuditLogger</code> is synchronous, file-based audit logger; just uses the
standard logging mechanism. <code>FileAuditLogger</code> logs events to
<code>audit/audit.log</code> file using <code>slf4j</code> logger.</p>
</div>
<div class="paragraph">
<p>The <code>NoOpAuditLogger</code> is a No-Op implementation of the audit logger to
be used as a default audit logger when audit logging is disabled.</p>
</div>
</div>
<div class="sect2">
<h3 id="setting-the-audit-logs-directory"><a class="anchor" href="#setting-the-audit-logs-directory"></a>Setting the Audit Logs Directory</h3>
<div class="paragraph">
<p>The audit logs directory is set with the <code>audit_logs_dir</code> option. A new
directory is not created automatically and an existing directory must be
set. Audit Logs directory can be configured using
<code>cassandra.logdir.audit</code> system property or default is set to
<code>cassandra.logdir + /audit/</code>. A user created directory may be set. As an
example, create a directory for the audit logs and set its permissions.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>sudo mkdir –p  /cassandra/audit/logs/hourly
sudo chmod -R 777 /cassandra/audit/logs/hourly</pre>
</div>
</div>
<div class="paragraph">
<p>Set the directory for the audit logs directory using the
<code>audit_logs_dir</code> option.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>audit_logs_dir: "/cassandra/audit/logs/hourly"</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="setting-keyspaces-to-audit"><a class="anchor" href="#setting-keyspaces-to-audit"></a>Setting Keyspaces to Audit</h3>
<div class="paragraph">
<p>Set the keyspaces to include with the <code>included_keyspaces</code> option and
the keyspaces to exclude with the <code>excluded_keyspaces</code> option. By
default all keyspaces are included. By default, <code>system</code>,
<code>system_schema</code> and <code>system_virtual_schema</code> are excluded.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># included_keyspaces:
# excluded_keyspaces: system, system_schema, system_virtual_schema</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="setting-categories-to-audit"><a class="anchor" href="#setting-categories-to-audit"></a>Setting Categories to Audit</h3>
<div class="paragraph">
<p>The categories of database operations to be included are specified with
the <code>included_categories</code> option as a comma separated list. By default
all supported categories are included. The categories of database
operations to be excluded are specified with <code>excluded_categories</code>
option as a comma separated list. By default no category is excluded.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># included_categories:
# excluded_categories:</pre>
</div>
</div>
<div class="paragraph">
<p>The supported categories for audit log are:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>QUERY</p>
</li>
<li>
<p>DML</p>
</li>
<li>
<p>DDL</p>
</li>
<li>
<p>DCL</p>
</li>
<li>
<p>OTHER</p>
</li>
<li>
<p>AUTH</p>
</li>
<li>
<p>ERROR</p>
</li>
<li>
<p>PREPARE</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="setting-users-to-audit"><a class="anchor" href="#setting-users-to-audit"></a>Setting Users to Audit</h3>
<div class="paragraph">
<p>Users to audit log are set with the <code>included_users</code> and
<code>excluded_users</code> options. The <code>included_users</code> option specifies a comma
separated list of users to include explicitly and by default all users
are included. The <code>excluded_users</code> option specifies a comma separated
list of users to exclude explicitly and by default no user is excluded.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># included_users:
# excluded_users:</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="setting-the-roll-frequency"><a class="anchor" href="#setting-the-roll-frequency"></a>Setting the Roll Frequency</h3>
<div class="paragraph">
<p>The <code>roll_cycle</code> option sets the frequency at which the audit log file
is rolled. Supported values are <code>MINUTELY</code>, <code>HOURLY</code>, and <code>DAILY</code>.
Default value is <code>HOURLY</code>, which implies that after every hour a new
audit log file is created.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>roll_cycle: HOURLY</pre>
</div>
</div>
<div class="paragraph">
<p>An audit log file could get rolled for other reasons as well such as a
log file reaches the configured size threshold.</p>
</div>
</div>
<div class="sect2">
<h3 id="setting-archiving-options"><a class="anchor" href="#setting-archiving-options"></a>Setting Archiving Options</h3>
<div class="paragraph">
<p>The archiving options are for archiving the rolled audit logs. The
<code>archive</code> command to use is set with the <code>archive_command</code> option and
the <code>max_archive_retries</code> sets the maximum # of tries of failed archive
commands.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># archive_command:
# max_archive_retries: 10</pre>
</div>
</div>
<div class="paragraph">
<p>Default archive command is <code>"/path/to/script.sh %path"</code> where <code>%path</code> is
replaced with the file being rolled:</p>
</div>
</div>
<div class="sect2">
<h3 id="other-settings"><a class="anchor" href="#other-settings"></a>Other Settings</h3>
<div class="paragraph">
<p>The other audit logs settings are as follows.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># block: true
# max_queue_weight: 268435456 # 256 MiB
# max_log_size: 17179869184 # 16 GiB</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>block</code> option specifies whether the audit logging should block if
the logging falls behind or should drop log records.</p>
</div>
<div class="paragraph">
<p>The <code>max_queue_weight</code> option sets the maximum weight of in memory queue
for records waiting to be written to the file before blocking or
dropping.</p>
</div>
<div class="paragraph">
<p>The <code>max_log_size</code> option sets the maximum size of the rolled files to
retain on disk before deleting the oldest.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-nodetool-to-enable-audit-logging"><a class="anchor" href="#using-nodetool-to-enable-audit-logging"></a>Using Nodetool to Enable Audit Logging</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>nodetool  enableauditlog</code> command may be used to enable audit logs
and it overrides the settings in <code>cassandra.yaml</code>. The
<code>nodetool enableauditlog</code> command syntax is as follows.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>nodetool [(-h &lt;host&gt; | --host &lt;host&gt;)] [(-p &lt;port&gt; | --port &lt;port&gt;)]
        [(-pp | --print-port)] [(-pw &lt;password&gt; | --password &lt;password&gt;)]
        [(-pwf &lt;passwordFilePath&gt; | --password-file &lt;passwordFilePath&gt;)]
        [(-u &lt;username&gt; | --username &lt;username&gt;)] enableauditlog
        [--excluded-categories &lt;excluded_categories&gt;]
        [--excluded-keyspaces &lt;excluded_keyspaces&gt;]
        [--excluded-users &lt;excluded_users&gt;]
        [--included-categories &lt;included_categories&gt;]
        [--included-keyspaces &lt;included_keyspaces&gt;]
        [--included-users &lt;included_users&gt;] [--logger &lt;logger&gt;]</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">OPTIONS</dt>
<dd>
<div class="dlist">
<dl>
<dt class="hdlist1">--excluded-categories &lt;excluded_categories&gt;</dt>
<dd>
<p>Comma separated list of Audit Log Categories to be excluded for
audit log. If not set the value from cassandra.yaml will be used</p>
</dd>
<dt class="hdlist1">--excluded-keyspaces &lt;excluded_keyspaces&gt;</dt>
<dd>
<p>Comma separated list of keyspaces to be excluded for audit log. If
not set the value from cassandra.yaml will be used</p>
</dd>
<dt class="hdlist1">--excluded-users &lt;excluded_users&gt;</dt>
<dd>
<p>Comma separated list of users to be excluded for audit log. If not
set the value from cassandra.yaml will be used</p>
</dd>
<dt class="hdlist1">-h &lt;host&gt;, --host &lt;host&gt;</dt>
<dd>
<p>Node hostname or ip address</p>
</dd>
<dt class="hdlist1">--included-categories &lt;included_categories&gt;</dt>
<dd>
<p>Comma separated list of Audit Log Categories to be included for
audit log. If not set the value from cassandra.yaml will be used</p>
</dd>
<dt class="hdlist1">--included-keyspaces &lt;included_keyspaces&gt;</dt>
<dd>
<p>Comma separated list of keyspaces to be included for audit log. If
not set the value from cassandra.yaml will be used</p>
</dd>
<dt class="hdlist1">--included-users &lt;included_users&gt;</dt>
<dd>
<p>Comma separated list of users to be included for audit log. If not
set the value from cassandra.yaml will be used</p>
</dd>
<dt class="hdlist1">--logger &lt;logger&gt;</dt>
<dd>
<p>Logger name to be used for AuditLogging. Default BinAuditLogger. If
not set the value from cassandra.yaml will be used</p>
</dd>
<dt class="hdlist1">-p &lt;port&gt;, --port &lt;port&gt;</dt>
<dd>
<p>Remote jmx agent port number</p>
</dd>
<dt class="hdlist1">-pp, --print-port</dt>
<dd>
<p>Operate in 4.0 mode with hosts disambiguated by port number</p>
</dd>
<dt class="hdlist1">-pw &lt;password&gt;, --password &lt;password&gt;</dt>
<dd>
<p>Remote jmx agent password</p>
</dd>
<dt class="hdlist1">-pwf &lt;passwordFilePath&gt;, --password-file &lt;passwordFilePath&gt;</dt>
<dd>
<p>Path to the JMX password file</p>
</dd>
<dt class="hdlist1">-u &lt;username&gt;, --username &lt;username&gt;</dt>
<dd>
<p>Remote jmx agent username</p>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The <code>nodetool disableauditlog</code> command disables audit log. The command
syntax is as follows.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>nodetool [(-h &lt;host&gt; | --host &lt;host&gt;)] [(-p &lt;port&gt; | --port &lt;port&gt;)]
        [(-pp | --print-port)] [(-pw &lt;password&gt; | --password &lt;password&gt;)]
        [(-pwf &lt;passwordFilePath&gt; | --password-file &lt;passwordFilePath&gt;)]
        [(-u &lt;username&gt; | --username &lt;username&gt;)] disableauditlog</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">OPTIONS</dt>
<dd>
<div class="dlist">
<dl>
<dt class="hdlist1">-h &lt;host&gt;, --host &lt;host&gt;</dt>
<dd>
<p>Node hostname or ip address</p>
</dd>
<dt class="hdlist1">-p &lt;port&gt;, --port &lt;port&gt;</dt>
<dd>
<p>Remote jmx agent port number</p>
</dd>
<dt class="hdlist1">-pp, --print-port</dt>
<dd>
<p>Operate in 4.0 mode with hosts disambiguated by port number</p>
</dd>
<dt class="hdlist1">-pw &lt;password&gt;, --password &lt;password&gt;</dt>
<dd>
<p>Remote jmx agent password</p>
</dd>
<dt class="hdlist1">-pwf &lt;passwordFilePath&gt;, --password-file &lt;passwordFilePath&gt;</dt>
<dd>
<p>Path to the JMX password file</p>
</dd>
<dt class="hdlist1">-u &lt;username&gt;, --username &lt;username&gt;</dt>
<dd>
<p>Remote jmx agent username</p>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="viewing-the-audit-logs"><a class="anchor" href="#viewing-the-audit-logs"></a>Viewing the Audit Logs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>An audit log event comprises of a keyspace that is being audited, the
operation that is being logged, the scope and the user. An audit log
entry comprises of the following attributes concatenated with a "|".</p>
</div>
<div class="literalblock">
<div class="content">
<pre>type (AuditLogEntryType): Type of request
source (InetAddressAndPort): Source IP Address from which request originated
user (String): User name
timestamp (long ): Timestamp of the request
batch (UUID): Batch of request
keyspace (String): Keyspace on which request is made
scope (String): Scope of request such as Table/Function/Aggregate name
operation (String): Database operation such as CQL command
options (QueryOptions): CQL Query options
state (QueryState): State related to a given query</pre>
</div>
</div>
<div class="paragraph">
<p>Some of these attributes may not be applicable to a given request and
not all of these options must be set.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="an-audit-logging-demo"><a class="anchor" href="#an-audit-logging-demo"></a>An Audit Logging Demo</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To demonstrate audit logging enable and configure audit logs with
following settings.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>audit_logging_options:
   enabled: true
   logger: BinAuditLogger
   audit_logs_dir: "/cassandra/audit/logs/hourly"
   # included_keyspaces:
   # excluded_keyspaces: system, system_schema, system_virtual_schema
   # included_categories:
   # excluded_categories:
   # included_users:
   # excluded_users:
   roll_cycle: HOURLY
   # block: true
   # max_queue_weight: 268435456 # 256 MiB
   # max_log_size: 17179869184 # 16 GiB
   ## archive command is "/path/to/script.sh %path" where %path is replaced with the file being rolled:
   # archive_command:
   # max_archive_retries: 10</pre>
</div>
</div>
<div class="paragraph">
<p>Create the audit log directory <code>/cassandra/audit/logs/hourly</code> and set
its permissions as discussed earlier. Run some CQL commands such as
create a keyspace, create a table and query a table. Any supported CQL
commands may be run as discussed in section <strong>What does Audit Logging
Log?</strong>. Change directory (with <code>cd</code> command) to the audit logs directory.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cd /cassandra/audit/logs/hourly</pre>
</div>
</div>
<div class="paragraph">
<p>List the files/directories and some <code>.cq4</code> files should get listed.
These are the audit logs files.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[ec2-user@ip-10-0-2-238 hourly]$ ls -l
total 28
-rw-rw-r--. 1 ec2-user ec2-user 83886080 Aug  2 03:01 20190802-02.cq4
-rw-rw-r--. 1 ec2-user ec2-user 83886080 Aug  2 03:01 20190802-03.cq4
-rw-rw-r--. 1 ec2-user ec2-user    65536 Aug  2 03:01 directory-listing.cq4t</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>auditlogviewer</code> tool is used to dump audit logs. Run the
<code>auditlogviewer</code> tool. Audit log files directory path is a required
argument. The output should be similar to the following output.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[ec2-user@ip-10-0-2-238 hourly]$ auditlogviewer /cassandra/audit/logs/hourly
WARN  03:12:11,124 Using Pauser.sleepy() as not enough processors, have 2, needs 8+
Type: AuditLog
LogMessage:
user:anonymous|host:10.0.2.238:7000|source:/127.0.0.1|port:46264|timestamp:1564711427328|type :USE_KEYSPACE|category:OTHER|ks:auditlogkeyspace|operation:USE AuditLogKeyspace;
Type: AuditLog
LogMessage:
user:anonymous|host:10.0.2.238:7000|source:/127.0.0.1|port:46264|timestamp:1564711427329|type :USE_KEYSPACE|category:OTHER|ks:auditlogkeyspace|operation:USE "auditlogkeyspace"
Type: AuditLog
LogMessage:
user:anonymous|host:10.0.2.238:7000|source:/127.0.0.1|port:46264|timestamp:1564711446279|type :SELECT|category:QUERY|ks:auditlogkeyspace|scope:t|operation:SELECT * FROM t;
Type: AuditLog
LogMessage:
user:anonymous|host:10.0.2.238:7000|source:/127.0.0.1|port:46264|timestamp:1564713878834|type :DROP_TABLE|category:DDL|ks:auditlogkeyspace|scope:t|operation:DROP TABLE IF EXISTS
AuditLogKeyspace.t;
Type: AuditLog
LogMessage:
user:anonymous|host:10.0.2.238:7000|source:/3.91.56.164|port:42382|timestamp:1564714618360|ty
pe:REQUEST_FAILURE|category:ERROR|operation:CREATE KEYSPACE AuditLogKeyspace
WITH replication = {'class': 'SimpleStrategy', 'replication_factor' : 1};; Cannot add
existing keyspace "auditlogkeyspace"
Type: AuditLog
LogMessage:
user:anonymous|host:10.0.2.238:7000|source:/127.0.0.1|port:46264|timestamp:1564714690968|type :DROP_KEYSPACE|category:DDL|ks:auditlogkeyspace|operation:DROP KEYSPACE AuditLogKeyspace;
Type: AuditLog
LogMessage:
user:anonymous|host:10.0.2.238:7000|source:/3.91.56.164|port:42406|timestamp:1564714708329|ty pe:CREATE_KEYSPACE|category:DDL|ks:auditlogkeyspace|operation:CREATE KEYSPACE
AuditLogKeyspace
WITH replication = {'class': 'SimpleStrategy', 'replication_factor' : 1};
Type: AuditLog
LogMessage:
user:anonymous|host:10.0.2.238:7000|source:/127.0.0.1|port:46264|timestamp:1564714870678|type :USE_KEYSPACE|category:OTHER|ks:auditlogkeyspace|operation:USE auditlogkeyspace;
[ec2-user@ip-10-0-2-238 hourly]$</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>auditlogviewer</code> tool usage syntax is as follows.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>./auditlogviewer
Audit log files directory path is a required argument.
usage: auditlogviewer &lt;path1&gt; [&lt;path2&gt;...&lt;pathN&gt;] [options]
--
View the audit log contents in human readable format
--
Options are:
-f,--follow       Upon reaching the end of the log continue indefinitely
                  waiting for more records
-h,--help         display this help message
-r,--roll_cycle   How often to roll the log file was rolled. May be
                  necessary for Chronicle to correctly parse file names. (MINUTELY, HOURLY,
                  DAILY). Default HOURLY.</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="diagnostic-events-for-user-audit-logging"><a class="anchor" href="#diagnostic-events-for-user-audit-logging"></a>Diagnostic events for user audit logging</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Any native transport enabled client is able to subscribe to diagnostic
events that are raised around authentication and CQL operations. These
events can then be consumed and used by external tools to implement a
Cassandra user auditing solution.</p>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../../_/js/site.js"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
