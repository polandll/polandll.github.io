<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Virtual Tables :: Apache Cassandra Documentation</title>
    <meta name="generator" content="Antora 2.3.1">
    <link rel="stylesheet" href="../../../../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../../..">Apache Cassandra Documentation&nbsp;&nbsp;&nbsp;<img src="../../../../_/img/cassandra_logo.png"></a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Download</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Latest</a>
            <a class="navbar-item" href="#">3.x</a>
            <a class="navbar-item" href="#">3.0</a>
            <a class="navbar-item" href="#">2.1</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Documentation</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Latest</a>
            <a class="navbar-item" href="#">3.x</a>
            <a class="navbar-item" href="#">3.0</a>
            <a class="navbar-item" href="#">2.1</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Community</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Developer Mailing List</a>
            <a class="navbar-item" href="#">User Mailing List</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Blog</a>
	</div>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="ASCIIDOC_POC" data-version="4.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../index.html">ASCIIDOC_POC</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../index.html">Cassandra Documentation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../glossary.html">Glossary</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../bugs.html">How to report bugs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../contactus.html">Contact us</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Cassandra</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../architecture/index.html">Architecture</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../architecture/overview.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../architecture/dynamo.html">Dynamo</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../architecture/storage_engine.html">Storage engine</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../architecture/guarantees.html">Guarantees</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html">What&#8217;s new</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../getting_started/index.html">Getting Started</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../getting_started/installing.html">Installing Cassandra</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../getting_started/configuring.html">Configuring Cassandra</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../getting_started/querying.html">Inserting and querying</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../getting_started/drivers.html">Client drivers</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../getting_started/production.html">Production recommendations</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../data_modeling/index.html">Data Modeling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#cql/index.adoc{">CQL</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/changes.html">Changes</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/ddl.html">DDL</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/dml.html">DML</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/types.html">Data types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/operators.html">Operators</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/definitions.html">Definitions</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/indexes.html">Secondary indexes</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/mvs.html">Materialized views</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/functions.html">Functions</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/json.html">JSON</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/security.html">Security</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/triggers.html">Triggers</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/appendices.html">Appendices</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/index.html">Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operating/index.html">Operating</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tools/index.html">Tools</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../development/index.html">Development</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/index.html">Plug-ins</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../troubleshooting/index.html">Troubleshooting</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../faq/index.html">FAQ</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">ASCIIDOC_POC</span>
    <span class="version">4.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">ASCIIDOC_POC</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../index.html">4.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../index.html">ASCIIDOC_POC</a></li>
    <li><a href="virtualtables.html">Virtual Tables</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///Users/lorina.poland/CLONES/cassandra-examples/rst-to-asciidoc-tests/ASCIIDOC/modules/cassandra/pages/new/virtualtables.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<article class="doc">
<h1 class="page">Virtual Tables</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Apache Cassandra 4.0 implements virtual tables
(<a href="https://issues.apache.org/jira/browse/CASSANDRA-7622">CASSANDRA-7622</a>).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="definition"><a class="anchor" href="#definition"></a>Definition</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A virtual table is a table that is backed by an API instead of data
explicitly managed and stored as SSTables. Apache Cassandra 4.0
implements a virtual keyspace interface for virtual tables. Virtual
tables are specific to each node.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="objective"><a class="anchor" href="#objective"></a>Objective</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A virtual table could have several uses including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Expose metrics through CQL</p>
</li>
<li>
<p>Expose YAML configuration information</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="how-are-virtual-tables-different-from-regular-tables"><a class="anchor" href="#how-are-virtual-tables-different-from-regular-tables"></a>How are Virtual Tables different from regular tables?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Virtual tables and virtual keyspaces are quite different from regular
tables and keyspaces respectively such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Virtual tables are read-only, but it is likely to change</p>
</li>
<li>
<p>Virtual tables are not replicated</p>
</li>
<li>
<p>Virtual tables are local only and non distributed</p>
</li>
<li>
<p>Virtual tables have no associated SSTables</p>
</li>
<li>
<p>Consistency level of the queries sent virtual tables are ignored</p>
</li>
<li>
<p>Virtual tables are managed by Cassandra and a user cannot run DDL to
create new virtual tables or DML to modify existing virtual tables</p>
</li>
<li>
<p>Virtual tables are created in special keyspaces and not just any
keyspace</p>
</li>
<li>
<p>All existing virtual tables use <code>LocalPartitioner</code>. Since a virtual
table is not replicated the partitioner sorts in order of partition keys
instead of by their hash.</p>
</li>
<li>
<p>Making advanced queries with <code>ALLOW FILTERING</code> and aggregation
functions may be used with virtual tables even though in normal tables
we dont recommend it</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="virtual-keyspaces"><a class="anchor" href="#virtual-keyspaces"></a>Virtual Keyspaces</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Apache Cassandra 4.0 has added two new keyspaces for virtual tables:
<code>system_virtual_schema</code> and <code>system_views</code>. Run the following command to
list the keyspaces:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cqlsh&gt; DESC KEYSPACES;
system_schema  system       system_distributed  system_virtual_schema
system_auth      system_traces       system_views</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>system_virtual_schema keyspace</code> contains schema information on
virtual tables. The <code>system_views</code> keyspace contains the actual virtual
tables.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="virtual-table-limitations"><a class="anchor" href="#virtual-table-limitations"></a>Virtual Table Limitations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Virtual tables and virtual keyspaces have some limitations initially
though some of these could change such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Cannot alter or drop virtual keyspaces or tables</p>
</li>
<li>
<p>Cannot truncate virtual tables</p>
</li>
<li>
<p>Expiring columns are not supported by virtual tables</p>
</li>
<li>
<p>Conditional updates are not supported by virtual tables</p>
</li>
<li>
<p>Cannot create tables in virtual keyspaces</p>
</li>
<li>
<p>Cannot perform any operations against virtual keyspace</p>
</li>
<li>
<p>Secondary indexes are not supported on virtual tables</p>
</li>
<li>
<p>Cannot create functions in virtual keyspaces</p>
</li>
<li>
<p>Cannot create types in virtual keyspaces</p>
</li>
<li>
<p>Materialized views are not supported on virtual tables</p>
</li>
<li>
<p>Virtual tables don&#8217;t support <code>DELETE</code> statements</p>
</li>
<li>
<p>Cannot <code>CREATE TRIGGER</code> against a virtual table</p>
</li>
<li>
<p>Conditional <code>BATCH</code> statements cannot include mutations for virtual
tables</p>
</li>
<li>
<p>Cannot include a virtual table statement in a logged batch</p>
</li>
<li>
<p>Mutations for virtual and regular tables cannot exist in the same
batch</p>
</li>
<li>
<p>Conditional <code>BATCH</code> statements cannot include mutations for virtual
tables</p>
</li>
<li>
<p>Cannot create aggregates in virtual keyspaces; but may run aggregate
functions on select</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="listing-and-describing-virtual-tables"><a class="anchor" href="#listing-and-describing-virtual-tables"></a>Listing and Describing Virtual Tables</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Virtual tables in a virtual keyspace may be listed with <code>DESC TABLES</code>.
The <code>system_views</code> virtual keyspace tables include the following:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cqlsh&gt; USE system_views;
cqlsh:system_views&gt; DESC TABLES;
coordinator_scans   clients             tombstones_scanned  internode_inbound
disk_usage          sstable_tasks       live_scanned        caches
local_writes        max_partition_size  local_reads
coordinator_writes  internode_outbound  thread_pools
local_scans         coordinator_reads   settings</pre>
</div>
</div>
<div class="paragraph">
<p>Some of the salient virtual tables in <code>system_views</code> virtual keyspace
are described in Table 1.</p>
</div>
<div class="paragraph">
<p>Table 1 : Virtual Tables in system_views</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 98%;">
<colgroup>
<col style="width: 27%;">
<col style="width: 73%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Virtual Table</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">clients</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lists information about all connected clients.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">disk_usage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disk usage including disk_space, keyspace_name, and
table_name by system keyspaces.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">local_writes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A table metric for local writes including count,
keyspace_name, max, median, per_second, and table_name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">caches</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays the general cache information including cache name,
capacity_bytes, entry_count, hit_count, hit_ratio double,
recent_hit_rate_per_second, recent_request_rate_per_second,
request_count, and size_bytes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">local_reads</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A table metric for local reads information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sstable_tasks</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lists currently running tasks such as compactions and
upgrades on SSTables.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">internode_inbound</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lists information about the inbound internode
messaging.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">thread_pools</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lists metrics for each thread pool.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">settings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays configuration settings in cassandra.yaml.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">max_partition_size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A table metric for maximum partition size.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">internode_outbound</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Information about the outbound internode messaging.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>We shall discuss some of the virtual tables in more detail next.</p>
</div>
<div class="sect2">
<h3 id="clients-virtual-table"><a class="anchor" href="#clients-virtual-table"></a>Clients Virtual Table</h3>
<div class="paragraph">
<p>The <code>clients</code> virtual table lists all active connections (connected
clients) including their ip address, port, connection stage, driver
name, driver version, hostname, protocol version, request count, ssl
enabled, ssl protocol and user name:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cqlsh:system_views&gt; select * from system_views.clients;
 address   | port  | connection_stage | driver_name | driver_version | hostname  | protocol_version | request_count | ssl_cipher_suite | ssl_enabled | ssl_protocol | username
-----------+-------+------------------+-------------+----------------+-----------+------------------+---------------+------------------+-------------+--------------+-----------
 127.0.0.1 | 50628 |            ready |        null |           null | localhost |                4 |            55 |             null |       False |         null | anonymous
 127.0.0.1 | 50630 |            ready |        null |           null | localhost |                4 |            70 |             null |       False |         null | anonymous

(2 rows)</pre>
</div>
</div>
<div class="paragraph">
<p>Some examples of how <code>clients</code> can be used are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To find applications using old incompatible versions of drivers before
upgrading and with <code>nodetool enableoldprotocolversions</code> and
<code>nodetool disableoldprotocolversions</code> during upgrades.</p>
</li>
<li>
<p>To identify clients sending too many requests.</p>
</li>
<li>
<p>To find if SSL is enabled during the migration to and from ssl.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The virtual tables may be described with <code>DESCRIBE</code> statement. The DDL
listed however cannot be run to create a virtual table. As an example
describe the <code>system_views.clients</code> virtual table:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cqlsh:system_views&gt; DESC TABLE system_views.clients;
CREATE TABLE system_views.clients (
  address inet,
  connection_stage text,
  driver_name text,
  driver_version text,
  hostname text,
  port int,
  protocol_version int,
  request_count bigint,
  ssl_cipher_suite text,
  ssl_enabled boolean,
  ssl_protocol text,
  username text,
  PRIMARY KEY (address, port)) WITH CLUSTERING ORDER BY (port ASC)
  AND compaction = {'class': 'None'}
  AND compression = {};</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="caches-virtual-table"><a class="anchor" href="#caches-virtual-table"></a>Caches Virtual Table</h3>
<div class="paragraph">
<p>The <code>caches</code> virtual table lists information about the caches. The four
caches presently created are chunks, counters, keys and rows. A query on
the <code>caches</code> virtual table returns the following details:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cqlsh:system_views&gt; SELECT * FROM system_views.caches;
name     | capacity_bytes | entry_count | hit_count | hit_ratio | recent_hit_rate_per_second | recent_request_rate_per_second | request_count | size_bytes
---------+----------------+-------------+-----------+-----------+----------------------------+--------------------------------+---------------+------------
  chunks |      229638144 |          29 |       166 |      0.83 |                          5 |                              6 |           200 |     475136
counters |       26214400 |           0 |         0 |       NaN |                          0 |                              0 |             0 |          0
    keys |       52428800 |          14 |       124 |  0.873239 |                          4 |                              4 |           142 |       1248
    rows |              0 |           0 |         0 |       NaN |                          0 |                              0 |             0 |          0

(4 rows)</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="settings-virtual-table"><a class="anchor" href="#settings-virtual-table"></a>Settings Virtual Table</h3>
<div class="paragraph">
<p>The <code>settings</code> table is rather useful and lists all the current
configuration settings from the <code>cassandra.yaml</code>. The encryption options
are overridden to hide the sensitive truststore information or
passwords. The configuration settings however cannot be set using DML on
the virtual table presently: :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cqlsh:system_views&gt; SELECT * FROM system_views.settings;

name                                 | value
-------------------------------------+--------------------
  allocate_tokens_for_keyspace       | null
  audit_logging_options_enabled      | false
  auto_snapshot                      | true
  automatic_sstable_upgrade          | false
  cluster_name                       | Test Cluster
  enable_transient_replication       | false
  hinted_handoff_enabled             | true
  hints_directory                    | /home/ec2-user/cassandra/data/hints
  incremental_backups                | false
  initial_token                      | null
                           ...
                           ...
                           ...
  rpc_address                        | localhost
  ssl_storage_port                   | 7001
  start_native_transport             | true
  storage_port                       | 7000
  stream_entire_sstables             | true
  (224 rows)</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>settings</code> table can be really useful if yaml file has been changed
since startup and dont know running configuration, or to find if they
have been modified via jmx/nodetool or virtual tables.</p>
</div>
</div>
<div class="sect2">
<h3 id="thread-pools-virtual-table"><a class="anchor" href="#thread-pools-virtual-table"></a>Thread Pools Virtual Table</h3>
<div class="paragraph">
<p>The <code>thread_pools</code> table lists information about all thread pools.
Thread pool information includes active tasks, active tasks limit,
blocked tasks, blocked tasks all time, completed tasks, and pending
tasks. A query on the <code>thread_pools</code> returns following details:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cqlsh:system_views&gt; select * from system_views.thread_pools;

name                         | active_tasks | active_tasks_limit | blocked_tasks | blocked_tasks_all_time | completed_tasks | pending_tasks
------------------------------+--------------+--------------------+---------------+------------------------+-----------------+---------------
            AntiEntropyStage |            0 |                  1 |             0 |                      0 |               0 |             0
        CacheCleanupExecutor |            0 |                  1 |             0 |                      0 |               0 |             0
          CompactionExecutor |            0 |                  2 |             0 |                      0 |             881 |             0
        CounterMutationStage |            0 |                 32 |             0 |                      0 |               0 |             0
                 GossipStage |            0 |                  1 |             0 |                      0 |               0 |             0
             HintsDispatcher |            0 |                  2 |             0 |                      0 |               0 |             0
       InternalResponseStage |            0 |                  2 |             0 |                      0 |               0 |             0
         MemtableFlushWriter |            0 |                  2 |             0 |                      0 |               1 |             0
           MemtablePostFlush |            0 |                  1 |             0 |                      0 |               2 |             0
       MemtableReclaimMemory |            0 |                  1 |             0 |                      0 |               1 |             0
              MigrationStage |            0 |                  1 |             0 |                      0 |               0 |             0
                   MiscStage |            0 |                  1 |             0 |                      0 |               0 |             0
               MutationStage |            0 |                 32 |             0 |                      0 |               0 |             0
   Native-Transport-Requests |            1 |                128 |             0 |                      0 |             130 |             0
      PendingRangeCalculator |            0 |                  1 |             0 |                      0 |               1 |             0
PerDiskMemtableFlushWriter_0 |            0 |                  2 |             0 |                      0 |               1 |             0
                   ReadStage |            0 |                 32 |             0 |                      0 |              13 |             0
                 Repair-Task |            0 |         2147483647 |             0 |                      0 |               0 |             0
        RequestResponseStage |            0 |                  2 |             0 |                      0 |               0 |             0
                     Sampler |            0 |                  1 |             0 |                      0 |               0 |             0
    SecondaryIndexManagement |            0 |                  1 |             0 |                      0 |               0 |             0
          ValidationExecutor |            0 |         2147483647 |             0 |                      0 |               0 |             0
           ViewBuildExecutor |            0 |                  1 |             0 |                      0 |               0 |             0
           ViewMutationStage |            0 |                 32 |             0 |                      0 |               0 |             0</pre>
</div>
</div>
<div class="paragraph">
<p>(24 rows)</p>
</div>
</div>
<div class="sect2">
<h3 id="internode-inbound-messaging-virtual-table"><a class="anchor" href="#internode-inbound-messaging-virtual-table"></a>Internode Inbound Messaging Virtual Table</h3>
<div class="paragraph">
<p>The <code>internode_inbound</code> virtual table is for the internode inbound
messaging. Initially no internode inbound messaging may get listed. In
addition to the address, port, datacenter and rack information includes
corrupt frames recovered, corrupt frames unrecovered, error bytes, error
count, expired bytes, expired count, processed bytes, processed count,
received bytes, received count, scheduled bytes, scheduled count,
throttled count, throttled nanos, using bytes, using reserve bytes. A
query on the <code>internode_inbound</code> returns following details:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cqlsh:system_views&gt; SELECT * FROM system_views.internode_inbound;
address | port | dc | rack | corrupt_frames_recovered | corrupt_frames_unrecovered |
error_bytes | error_count | expired_bytes | expired_count | processed_bytes |
processed_count | received_bytes | received_count | scheduled_bytes | scheduled_count | throttled_count | throttled_nanos | using_bytes | using_reserve_bytes
---------+------+----+------+--------------------------+----------------------------+-
----------
(0 rows)</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sstables-tasks-virtual-table"><a class="anchor" href="#sstables-tasks-virtual-table"></a>SSTables Tasks Virtual Table</h3>
<div class="paragraph">
<p>The <code>sstable_tasks</code> could be used to get information about running
tasks. It lists following columns:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cqlsh:system_views&gt; SELECT * FROM sstable_tasks;
keyspace_name | table_name | task_id                              | kind       | progress | total    | unit
---------------+------------+--------------------------------------+------------+----------+----------+-------
       basic |      wide2 | c3909740-cdf7-11e9-a8ed-0f03de2d9ae1 | compaction | 60418761 | 70882110 | bytes
       basic |      wide2 | c7556770-cdf7-11e9-a8ed-0f03de2d9ae1 | compaction |  2995623 | 40314679 | bytes</pre>
</div>
</div>
<div class="paragraph">
<p>As another example, to find how much time is remaining for SSTable
tasks, use the following query:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>SELECT total - progress AS remaining
FROM system_views.sstable_tasks;</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="other-virtual-tables"><a class="anchor" href="#other-virtual-tables"></a>Other Virtual Tables</h3>
<div class="paragraph">
<p>Some examples of using other virtual tables are as follows.</p>
</div>
<div class="paragraph">
<p>Find tables with most disk usage:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cqlsh&gt; SELECT * FROM disk_usage WHERE mebibytes &gt; 1 ALLOW FILTERING;

keyspace_name | table_name | mebibytes
---------------+------------+-----------
   keyspace1 |  standard1 |       288
  tlp_stress |   keyvalue |      3211</pre>
</div>
</div>
<div class="paragraph">
<p>Find queries on table/s with greatest read latency:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cqlsh&gt; SELECT * FROM  local_read_latency WHERE per_second &gt; 1 ALLOW FILTERING;

keyspace_name | table_name | p50th_ms | p99th_ms | count    | max_ms  | per_second
---------------+------------+----------+----------+----------+---------+------------
  tlp_stress |   keyvalue |    0.043 |    0.152 | 49785158 | 186.563 |  11418.356</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="the-system_virtual_schema-keyspace"><a class="anchor" href="#the-system_virtual_schema-keyspace"></a>The system_virtual_schema keyspace</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>system_virtual_schema</code> keyspace has three tables: <code>keyspaces</code>,
<code>columns</code> and <code>tables</code> for the virtual keyspace definitions, virtual
table definitions, and virtual column definitions respectively. It is
used by Cassandra internally and a user would not need to access it
directly.</p>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../../_/js/site.js"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
