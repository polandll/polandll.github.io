<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Materialized Views :: Apache Cassandra Documentation</title>
    <meta name="generator" content="Antora 2.3.1">
    <link rel="stylesheet" href="../../../../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../../..">Apache Cassandra Documentation&nbsp;&nbsp;&nbsp;<img src="../../../../_/img/cassandra_logo.png"></a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Download</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Latest</a>
            <a class="navbar-item" href="#">3.x</a>
            <a class="navbar-item" href="#">3.0</a>
            <a class="navbar-item" href="#">2.1</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Documentation</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Latest</a>
            <a class="navbar-item" href="#">3.x</a>
            <a class="navbar-item" href="#">3.0</a>
            <a class="navbar-item" href="#">2.1</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Community</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Developer Mailing List</a>
            <a class="navbar-item" href="#">User Mailing List</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Blog</a>
	</div>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="ASCIIDOC_POC" data-version="4.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../index.html">ASCIIDOC_POC</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../index.html">Cassandra Documentation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../glossary.html">Glossary</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../bugs.html">How to report bugs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../contactus.html">Contact us</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Cassandra</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../architecture/index.html">Architecture</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../architecture/overview.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../architecture/dynamo.html">Dynamo</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../architecture/storage_engine.html">Storage engine</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../architecture/guarantees.html">Guarantees</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../new/index.html">What&#8217;s new</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../getting_started/index.html">Getting Started</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../getting_started/installing.html">Installing Cassandra</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../getting_started/configuring.html">Configuring Cassandra</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../getting_started/querying.html">Inserting and querying</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../getting_started/drivers.html">Client drivers</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../getting_started/production.html">Production recommendations</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../data_modeling/index.html">Data Modeling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#cql/index.adoc{">CQL</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="changes.html">Changes</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="ddl.html">DDL</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="dml.html">DML</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="types.html">Data types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="operators.html">Operators</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="definitions.html">Definitions</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="indexes.html">Secondary indexes</a>
  </li>
  <li class="nav-item is-current-page" data-depth="3">
    <a class="nav-link" href="mvs.html">Materialized views</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="functions.html">Functions</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="json.html">JSON</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="security.html">Security</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="triggers.html">Triggers</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="appendices.html">Appendices</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/index.html">Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operating/index.html">Operating</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tools/index.html">Tools</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../development/index.html">Development</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/index.html">Plug-ins</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../troubleshooting/index.html">Troubleshooting</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../faq/index.html">FAQ</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">ASCIIDOC_POC</span>
    <span class="version">4.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">ASCIIDOC_POC</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../index.html">4.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../index.html">ASCIIDOC_POC</a></li>
    <li>Cassandra</li>
    <li>CQL</li>
    <li><a href="mvs.html">Materialized views</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///Users/lorina.poland/CLONES/cassandra-examples/rst-to-asciidoc-tests/ASCIIDOC/modules/cassandra/pages/cql/mvs.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<article class="doc">
<h1 class="page">Materialized Views</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Materialized views names are defined by:</p>
</div>
<div class="paragraph">
<p>view_name: re('[a-zA-Z_0-9]+')</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="create-materialized-view-statement"><a class="anchor" href="#create-materialized-view-statement"></a>CREATE MATERIALIZED VIEW</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can create a materialized view on a table using a
<code>CREATE MATERIALIZED VIEW</code> statement:</p>
</div>
<div class="paragraph">
<p>create_materialized_view_statement: CREATE MATERIALIZED VIEW [ IF NOT
EXISTS ] <span class="title-ref">view_name</span> AS : <span class="title-ref">select_statement</span> :
PRIMARY KEY '(' <span class="title-ref">primary_key</span> ')' : WITH
<span class="title-ref">table_options</span></p>
</div>
<div class="paragraph">
<p>For instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cql hljs" data-lang="cql">CREATE MATERIALIZED VIEW monkeySpecies_by_population AS
    SELECT * FROM monkeySpecies
    WHERE population IS NOT NULL AND species IS NOT NULL
    PRIMARY KEY (population, species)
    WITH comment='Allow query by population instead of species';</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>CREATE MATERIALIZED VIEW</code> statement creates a new materialized
view. Each such view is a set of <em>rows</em> which corresponds to rows which
are present in the underlying, or base, table specified in the <code>SELECT</code>
statement. A materialized view cannot be directly updated, but updates
to the base table will cause corresponding updates in the view.</p>
</div>
<div class="paragraph">
<p>Creating a materialized view has 3 main parts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>select statement &lt;mv-select&gt;</code> that restrict the data included in
the view.</p>
</li>
<li>
<p>The <code>primary key &lt;mv-primary-key&gt;</code> definition for the view.</p>
</li>
<li>
<p>The <code>options &lt;mv-options&gt;</code> for the view.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Attempting to create an already existing materialized view will return
an error unless the <code>IF NOT EXISTS</code> option is used. If it is used, the
statement will be a no-op if the materialized view already exists.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>By default, materialized views are built in a single thread. The initial
build can be parallelized by increasing the number of threads specified
by the property <code>concurrent_materialized_view_builders</code> in
<code>cassandra.yaml</code>. This property can also be manipulated at runtime
through both JMX and the <code>setconcurrentviewbuilders</code> and
<code>getconcurrentviewbuilders</code> nodetool commands.
====<a id="mv-select"></a>
=== MV select statement</p>
</div>
<div class="paragraph">
<p>The select statement of a materialized view creation defines which of
the base table is included in the view. That statement is limited in a
number of ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <code>selection &lt;selection-clause&gt;</code> is limited to those that only
select columns of the base table. In other words, you can&#8217;t use any
function (aggregate or not), casting, term, etc. Aliases are also not
supported. You can however use <span class="title-ref">*</span> as a shortcut of
selecting all columns. Further, <code>static columns &lt;static-columns&gt;</code> cannot
be included in a materialized view (which means <code>SELECT *</code> isn&#8217;t allowed
if the base table has static columns).</p>
</li>
<li>
<p>the <code>WHERE</code> clause have the following restrictions:</p>
<div class="ulist">
<ul>
<li>
<p>it cannot include any <code>bind_marker</code>.</p>
</li>
<li>
<p>the columns that are not part of the <em>base table</em> primary key can
only be restricted by an <code>IS NOT NULL</code> restriction. No other restriction
is allowed.</p>
</li>
<li>
<p>as the columns that are part of the <em>view</em> primary key cannot be
null, they must always be at least restricted by a <code>IS NOT NULL</code>
restriction (or any other restriction, but they must have one).</p>
</li>
</ul>
</div>
</li>
<li>
<p>it cannot have neither an <code>ordering clause &lt;ordering-clause&gt;</code>, nor a
<code>limit &lt;limit-clause&gt;</code>, nor <code>ALLOW
FILTERING &lt;allow-filtering&gt;</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>=== MV primary key</p>
</div>
<div class="paragraph">
<p>A view must have a primary key and that primary key must conform to the
following restrictions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>it must contain all the primary key columns of the base table. This
ensures that every row of the view correspond to exactly one row of the
base table.</p>
</li>
<li>
<p>it can only contain a single column that is not a primary key column
in the base table.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>So for instance, give the following base table definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cql hljs" data-lang="cql">CREATE TABLE t (
    k int,
    c1 int,
    c2 int,
    v1 int,
    v2 int,
    PRIMARY KEY (k, c1, c2)
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>then the following view definitions are allowed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cql hljs" data-lang="cql">CREATE MATERIALIZED VIEW mv1 AS
    SELECT * FROM t WHERE k IS NOT NULL AND c1 IS NOT NULL AND c2 IS NOT NULL
    PRIMARY KEY (c1, k, c2)

CREATE MATERIALIZED VIEW mv1 AS
    SELECT * FROM t WHERE k IS NOT NULL AND c1 IS NOT NULL AND c2 IS NOT NULL
    PRIMARY KEY (v1, k, c1, c2)</code></pre>
</div>
</div>
<div class="paragraph">
<p>but the following ones are <strong>not</strong> allowed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-cql hljs" data-lang="cql">// Error: cannot include both v1 and v2 in the primary key as both are not in the base table primary key
CREATE MATERIALIZED VIEW mv1 AS
    SELECT * FROM t WHERE k IS NOT NULL AND c1 IS NOT NULL AND c2 IS NOT NULL AND v1 IS NOT NULL
    PRIMARY KEY (v1, v2, k, c1, c2)

// Error: must include k in the primary as it's a base table primary key column
CREATE MATERIALIZED VIEW mv1 AS
    SELECT * FROM t WHERE c1 IS NOT NULL AND c2 IS NOT NULL
    PRIMARY KEY (c1, c2)</code></pre>
</div>
</div>
<div class="paragraph">
<p>=== MV options</p>
</div>
<div class="paragraph">
<p>A materialized view is internally implemented by a table and as such,
creating a MV allows the <code>same options than
creating a table &lt;create-table-options&gt;</code>.</p>
</div>
<div id="alter-materialized-view-statement" class="paragraph">
<p>== ALTER MATERIALIZED VIEW</p>
</div>
<div class="paragraph">
<p>After creation, you can alter the options of a materialized view using
the <code>ALTER MATERIALIZED VIEW</code> statement:</p>
</div>
<div class="paragraph">
<p>alter_materialized_view_statement: ALTER MATERIALIZED VIEW
<span class="title-ref">view_name</span> WITH <span class="title-ref">table_options</span></p>
</div>
<div class="paragraph">
<p>The options that can be updated are the same than at creation time and
thus the <code>same than for tables
&lt;create-table-options&gt;</code>.</p>
</div>
<div id="drop-materialized-view-statement" class="paragraph">
<p>== DROP MATERIALIZED VIEW</p>
</div>
<div class="paragraph">
<p>Dropping a materialized view users the <code>DROP MATERIALIZED VIEW</code>
statement:</p>
</div>
<div class="paragraph">
<p>drop_materialized_view_statement: DROP MATERIALIZED VIEW [ IF EXISTS ]
<span class="title-ref">view_name</span>;</p>
</div>
<div class="paragraph">
<p>If the materialized view does not exists, the statement will return an
error, unless <code>IF EXISTS</code> is used in which case the operation is a
no-op.</p>
</div>
<div class="paragraph">
<p>=== MV Limitations</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Removal of columns not selected in the Materialized View (via <code>UPDATE base SET unselected_column = null</code> or <code>DELETE unselected_column FROM base</code>) may shadow missed updates to other columns received by hints or repair. For this reason, we advise against doing deletions on base columns not selected in views until this is fixed on CASSANDRA-13826.</p>
</div>
<div class="exampleblock">
<div class="content">

</div>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../../_/js/site.js"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
