<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Bulk Loading :: Apache Cassandra Documentation</title>
    <meta name="generator" content="Antora 2.3.1">
    <link rel="stylesheet" href="../../../../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../../..">Apache Cassandra Documentation&nbsp;&nbsp;&nbsp;<img src="../../../../_/img/cassandra_logo.png"></a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Download</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Latest</a>
            <a class="navbar-item" href="#">3.x</a>
            <a class="navbar-item" href="#">3.0</a>
            <a class="navbar-item" href="#">2.1</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Documentation</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Latest</a>
            <a class="navbar-item" href="#">3.x</a>
            <a class="navbar-item" href="#">3.0</a>
            <a class="navbar-item" href="#">2.1</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Community</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Developer Mailing List</a>
            <a class="navbar-item" href="#">User Mailing List</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Blog</a>
	</div>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="ASCIIDOC_POC" data-version="4.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../index.html">ASCIIDOC_POC</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../index.html">Cassandra Documentation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../glossary.html">Glossary</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../bugs.html">How to report bugs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../contactus.html">Contact us</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Cassandra</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../architecture/index.html">Architecture</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../architecture/overview.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../architecture/dynamo.html">Dynamo</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../architecture/storage_engine.html">Storage engine</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../architecture/guarantees.html">Guarantees</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../new/index.html">What&#8217;s new</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../getting_started/index.html">Getting Started</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../getting_started/installing.html">Installing Cassandra</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../getting_started/configuring.html">Configuring Cassandra</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../getting_started/querying.html">Inserting and querying</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../getting_started/drivers.html">Client drivers</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../getting_started/production.html">Production recommendations</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../data_modeling/index.html">Data Modeling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#cql/index.adoc{">CQL</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/changes.html">Changes</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/ddl.html">DDL</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/dml.html">DML</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/types.html">Data types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/operators.html">Operators</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/definitions.html">Definitions</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/indexes.html">Secondary indexes</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/mvs.html">Materialized views</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/functions.html">Functions</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/json.html">JSON</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/security.html">Security</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/triggers.html">Triggers</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/appendices.html">Appendices</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/index.html">Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html">Operating</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tools/index.html">Tools</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../development/index.html">Development</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/index.html">Plug-ins</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../troubleshooting/index.html">Troubleshooting</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../faq/index.html">FAQ</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">ASCIIDOC_POC</span>
    <span class="version">4.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">ASCIIDOC_POC</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../index.html">4.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../index.html">ASCIIDOC_POC</a></li>
    <li><a href="bulk_loading.html">Bulk Loading</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///Users/lorina.poland/CLONES/cassandra-examples/rst-to-asciidoc-tests/ASCIIDOC/modules/cassandra/pages/operating/bulk_loading.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<article class="doc">
<h1 class="page">Bulk Loading</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Bulk loading of data in Apache Cassandra is supported by different
tools. The data to be bulk loaded must be in the form of SSTables.
Cassandra does not support loading data in any other format such as CSV,
JSON, and XML directly. Bulk loading could be used to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Restore incremental backups and snapshots. Backups and snapshots are
already in the form of SSTables.</p>
</li>
<li>
<p>Load existing SSTables into another cluster, which could have a
different number of nodes or replication strategy.</p>
</li>
<li>
<p>Load external data into a cluster</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>*<em>Note</em>: CSV Data can be loaded via the cqlsh COPY command but we do not
recommend this for bulk loading, which typically requires many GB or TB
of data.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tools-for-bulk-loading"><a class="anchor" href="#tools-for-bulk-loading"></a>Tools for Bulk Loading</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Cassandra provides two commands or tools for bulk loading data. These
are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Cassandra Bulk loader, also called <code>sstableloader</code></p>
</li>
<li>
<p>The <code>nodetool import</code> command</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>sstableloader</code> and <code>nodetool import</code> are accessible if the
Cassandra installation <code>bin</code> directory is in the <code>PATH</code> environment
variable. Or these may be accessed directly from the <code>bin</code> directory. We
shall discuss each of these next. We shall use the example or sample
keyspaces and tables created in the Backups section.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-sstableloader"><a class="anchor" href="#using-sstableloader"></a>Using sstableloader</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>sstableloader</code> is the main tool for bulk uploading data. The
<code>sstableloader</code> streams SSTable data files to a running cluster. The
<code>sstableloader</code> loads data conforming to the replication strategy and
replication factor. The table to upload data to does need not to be
empty.</p>
</div>
<div class="paragraph">
<p>The only requirements to run <code>sstableloader</code> are:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>One or more comma separated initial hosts to connect to and get ring
information.</p>
</li>
<li>
<p>A directory path for the SSTables to load.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Its usage is as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">sstableloader [options] &lt;dir_path&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Sstableloader bulk loads the SSTables found in the directory
<code>&lt;dir_path&gt;</code> to the configured cluster. The <code>&lt;dir_path&gt;</code> is used as the
target <em>keyspace/table</em> name. As an example, to load an SSTable named
<code>Standard1-g-1-Data.db</code> into <code>Keyspace1/Standard1</code>, you will need to
have the files <code>Standard1-g-1-Data.db</code> and <code>Standard1-g-1-Index.db</code> in a
directory <code>/path/to/Keyspace1/Standard1/</code>.</p>
</div>
<div class="sect2">
<h3 id="sstableloader-option-to-accept-target-keyspace-name"><a class="anchor" href="#sstableloader-option-to-accept-target-keyspace-name"></a>Sstableloader Option to accept Target keyspace name</h3>
<div class="paragraph">
<p>Often as part of a backup strategy some Cassandra DBAs store an entire
data directory. When corruption in data is found then they would like to
restore data in the same cluster (for large clusters 200 nodes) but with
different keyspace name.</p>
</div>
<div class="paragraph">
<p>Currently <code>sstableloader</code> derives keyspace name from the folder
structure. As an option to specify target keyspace name as part of
<code>sstableloader</code>, version 4.0 adds support for the <code>--target-keyspace</code>
option
(<a href="https://issues.apache.org/jira/browse/CASSANDRA-13884">CASSANDRA-13884</a>).</p>
</div>
<div class="paragraph">
<p>The supported options are as follows from which only
<code>-d,--nodes &lt;initial hosts&gt;</code> is required.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">-alg,--ssl-alg &lt;ALGORITHM&gt;                                   Client SSL: algorithm

-ap,--auth-provider &lt;auth provider&gt;                          Custom
                                                             AuthProvider class name for
                                                             cassandra authentication
-ciphers,--ssl-ciphers &lt;CIPHER-SUITES&gt;                       Client SSL:
                                                             comma-separated list of
                                                             encryption suites to use
-cph,--connections-per-host &lt;connectionsPerHost&gt;             Number of
                                                             concurrent connections-per-host.
-d,--nodes &lt;initial hosts&gt;                                   Required.
                                                             Try to connect to these hosts (comma separated) initially for ring information

-f,--conf-path &lt;path to config file&gt;                         cassandra.yaml file path for streaming throughput and client/server SSL.

-h,--help                                                    Display this help message

-i,--ignore &lt;NODES&gt;                                          Don't stream to this (comma separated) list of nodes

-idct,--inter-dc-throttle &lt;inter-dc-throttle&gt;                Inter-datacenter throttle speed in Mbits (default unlimited)

-k,--target-keyspace &lt;target keyspace name&gt;                  Target
                                                             keyspace name
-ks,--keystore &lt;KEYSTORE&gt;                                    Client SSL:
                                                             full path to keystore
-kspw,--keystore-password &lt;KEYSTORE-PASSWORD&gt;                Client SSL:
                                                             password of the keystore
--no-progress                                                Don't
                                                             display progress
-p,--port &lt;native transport port&gt;                            Port used
                                                             for native connection (default 9042)
-prtcl,--ssl-protocol &lt;PROTOCOL&gt;                             Client SSL:
                                                             connections protocol to use (default: TLS)
-pw,--password &lt;password&gt;                                    Password for
                                                             cassandra authentication
-sp,--storage-port &lt;storage port&gt;                            Port used
                                                             for internode communication (default 7000)
-spd,--server-port-discovery &lt;allow server port discovery&gt;   Use ports
                                                             published by server to decide how to connect. With SSL requires StartTLS
                                                             to be used.
-ssp,--ssl-storage-port &lt;ssl storage port&gt;                   Port used
                                                             for TLS internode communication (default 7001)
-st,--store-type &lt;STORE-TYPE&gt;                                Client SSL:
                                                             type of store
-t,--throttle &lt;throttle&gt;                                     Throttle
                                                             speed in Mbits (default unlimited)
-ts,--truststore &lt;TRUSTSTORE&gt;                                Client SSL:
                                                             full path to truststore
-tspw,--truststore-password &lt;TRUSTSTORE-PASSWORD&gt;            Client SSL:
                                                             Password of the truststore
-u,--username &lt;username&gt;                                     Username for
                                                             cassandra authentication
-v,--verbose                                                 verbose
                                                             output</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>cassandra.yaml</code> file could be provided on the command-line with
<code>-f</code> option to set up streaming throughput, client and server encryption
options. Only <code>stream_throughput_outbound_megabits_per_sec</code>,
<code>server_encryption_options</code> and <code>client_encryption_options</code> are read
from yaml. You can override options read from <code>cassandra.yaml</code> with
corresponding command line options.</p>
</div>
</div>
<div class="sect2">
<h3 id="a-sstableloader-demo"><a class="anchor" href="#a-sstableloader-demo"></a>A sstableloader Demo</h3>
<div class="paragraph">
<p>We shall demonstrate using <code>sstableloader</code> by uploading incremental
backup data for table <code>catalogkeyspace.magazine</code>. We shall also use a
snapshot of the same table to bulk upload in a different run of
<code>sstableloader</code>. The backups and snapshots for the
<code>catalogkeyspace.magazine</code> table are listed as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">[ec2-user@ip-10-0-2-238 ~]$ cd ./cassandra/data/data/catalogkeyspace/magazine-
446eae30c22a11e9b1350d927649052c
[ec2-user@ip-10-0-2-238 magazine-446eae30c22a11e9b1350d927649052c]$ ls -l
total 0
drwxrwxr-x. 2 ec2-user ec2-user 226 Aug 19 02:38 backups
drwxrwxr-x. 4 ec2-user ec2-user  40 Aug 19 02:45 snapshots</code></pre>
</div>
</div>
<div class="paragraph">
<p>The directory path structure of SSTables to be uploaded using
<code>sstableloader</code> is used as the target keyspace/table.</p>
</div>
<div class="paragraph">
<p>We could have directly uploaded from the <code>backups</code> and <code>snapshots</code>
directories respectively if the directory structure were in the format
used by <code>sstableloader</code>. But the directory path of backups and snapshots
for SSTables is
<code>/catalogkeyspace/magazine-446eae30c22a11e9b1350d927649052c/backups</code> and
<code>/catalogkeyspace/magazine-446eae30c22a11e9b1350d927649052c/snapshots</code>
respectively, which cannot be used to upload SSTables to
<code>catalogkeyspace.magazine</code> table. The directory path structure must be
<code>/catalogkeyspace/magazine/</code> to use <code>sstableloader</code>. We need to create a
new directory structure to upload SSTables with <code>sstableloader</code> which is
typical when using <code>sstableloader</code>. Create a directory structure
<code>/catalogkeyspace/magazine</code> and set its permissions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">[ec2-user@ip-10-0-2-238 ~]$ sudo mkdir -p /catalogkeyspace/magazine
[ec2-user@ip-10-0-2-238 ~]$ sudo chmod -R 777 /catalogkeyspace/magazine</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="bulk-loading-from-an-incremental-backup"><a class="anchor" href="#bulk-loading-from-an-incremental-backup"></a>Bulk Loading from an Incremental Backup</h4>
<div class="paragraph">
<p>An incremental backup does not include the DDL for a table. The table
must already exist. If the table was dropped it may be created using the
<code>schema.cql</code> generated with every snapshot of a table. As we shall be
using <code>sstableloader</code> to load SSTables to the <code>magazine</code> table, the
table must exist prior to running <code>sstableloader</code>. The table does not
need to be empty but we have used an empty table as indicated by a CQL
query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">cqlsh:catalogkeyspace&gt; SELECT * FROM magazine;

id | name | publisher
----+------+-----------

(0 rows)</code></pre>
</div>
</div>
<div class="paragraph">
<p>After the table to upload has been created copy the SSTable files from
the <code>backups</code> directory to the <code>/catalogkeyspace/magazine/</code> directory
that we created.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">[ec2-user@ip-10-0-2-238 ~]$ sudo cp ./cassandra/data/data/catalogkeyspace/magazine-
446eae30c22a11e9b1350d927649052c/backups/* /catalogkeyspace/magazine/</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run the <code>sstableloader</code> to upload SSTables from the
<code>/catalogkeyspace/magazine/</code> directory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">sstableloader --nodes 10.0.2.238  /catalogkeyspace/magazine/</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output from the <code>sstableloader</code> command should be similar to the
listed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">[ec2-user@ip-10-0-2-238 ~]$ sstableloader --nodes 10.0.2.238  /catalogkeyspace/magazine/
Opening SSTables and calculating sections to stream
Streaming relevant part of /catalogkeyspace/magazine/na-1-big-Data.db
/catalogkeyspace/magazine/na-2-big-Data.db  to [35.173.233.153:7000, 10.0.2.238:7000,
54.158.45.75:7000]
progress: [35.173.233.153:7000]0:1/2 88 % total: 88% 0.018KiB/s (avg: 0.018KiB/s)
progress: [35.173.233.153:7000]0:2/2 176% total: 176% 33.807KiB/s (avg: 0.036KiB/s)
progress: [35.173.233.153:7000]0:2/2 176% total: 176% 0.000KiB/s (avg: 0.029KiB/s)
progress: [35.173.233.153:7000]0:2/2 176% [10.0.2.238:7000]0:1/2 39 % total: 81% 0.115KiB/s
(avg: 0.024KiB/s)
progress: [35.173.233.153:7000]0:2/2 176% [10.0.2.238:7000]0:2/2 78 % total: 108%
97.683KiB/s (avg: 0.033KiB/s)
progress: [35.173.233.153:7000]0:2/2 176% [10.0.2.238:7000]0:2/2 78 %
[54.158.45.75:7000]0:1/2 39 % total: 80% 0.233KiB/s (avg: 0.040KiB/s)
progress: [35.173.233.153:7000]0:2/2 176% [10.0.2.238:7000]0:2/2 78 %
[54.158.45.75:7000]0:2/2 78 % total: 96% 88.522KiB/s (avg: 0.049KiB/s)
progress: [35.173.233.153:7000]0:2/2 176% [10.0.2.238:7000]0:2/2 78 %
[54.158.45.75:7000]0:2/2 78 % total: 96% 0.000KiB/s (avg: 0.045KiB/s)
progress: [35.173.233.153:7000]0:2/2 176% [10.0.2.238:7000]0:2/2 78 %
[54.158.45.75:7000]0:2/2 78 % total: 96% 0.000KiB/s (avg: 0.044KiB/s)</code></pre>
</div>
</div>
<div class="paragraph">
<p>After the <code>sstableloader</code> has run query the <code>magazine</code> table and the
loaded table should get listed when a query is run.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">cqlsh:catalogkeyspace&gt; SELECT * FROM magazine;

id | name                      | publisher
----+---------------------------+------------------
 1 |        Couchbase Magazine |        Couchbase
 0 | Apache Cassandra Magazine | Apache Cassandra

(2 rows)
cqlsh:catalogkeyspace&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bulk-loading-from-a-snapshot"><a class="anchor" href="#bulk-loading-from-a-snapshot"></a>Bulk Loading from a Snapshot</h4>
<div class="paragraph">
<p>In this section we shall demonstrate restoring a snapshot of the
<code>magazine</code> table to the <code>magazine</code> table. As we used the same table to
restore data from a backup the directory structure required by
<code>sstableloader</code> should already exist. If the directory structure needed
to load SSTables to <code>catalogkeyspace.magazine</code> does not exist create the
directories and set their permissions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">[ec2-user@ip-10-0-2-238 ~]$ sudo mkdir -p /catalogkeyspace/magazine
[ec2-user@ip-10-0-2-238 ~]$ sudo chmod -R 777 /catalogkeyspace/magazine</code></pre>
</div>
</div>
<div class="paragraph">
<p>As we shall be copying the snapshot files to the directory remove any
files that may be in the directory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">[ec2-user@ip-10-0-2-238 ~]$ sudo rm /catalogkeyspace/magazine/*
[ec2-user@ip-10-0-2-238 ~]$ cd /catalogkeyspace/magazine/
[ec2-user@ip-10-0-2-238 magazine]$ ls -l
total 0</code></pre>
</div>
</div>
<div class="paragraph">
<p>Copy the snapshot files to the <code>/catalogkeyspace/magazine</code> directory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">[ec2-user@ip-10-0-2-238 ~]$ sudo cp ./cassandra/data/data/catalogkeyspace/magazine-
446eae30c22a11e9b1350d927649052c/snapshots/magazine/* /catalogkeyspace/magazine</code></pre>
</div>
</div>
<div class="paragraph">
<p>List the files in the <code>/catalogkeyspace/magazine</code> directory and a
<code>schema.cql</code> should also get listed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">[ec2-user@ip-10-0-2-238 ~]$ cd /catalogkeyspace/magazine
[ec2-user@ip-10-0-2-238 magazine]$ ls -l
total 44
-rw-r--r--. 1 root root   31 Aug 19 04:13 manifest.json
-rw-r--r--. 1 root root   47 Aug 19 04:13 na-1-big-CompressionInfo.db
-rw-r--r--. 1 root root   97 Aug 19 04:13 na-1-big-Data.db
-rw-r--r--. 1 root root   10 Aug 19 04:13 na-1-big-Digest.crc32
-rw-r--r--. 1 root root   16 Aug 19 04:13 na-1-big-Filter.db
-rw-r--r--. 1 root root   16 Aug 19 04:13 na-1-big-Index.db
-rw-r--r--. 1 root root 4687 Aug 19 04:13 na-1-big-Statistics.db
-rw-r--r--. 1 root root   56 Aug 19 04:13 na-1-big-Summary.db
-rw-r--r--. 1 root root   92 Aug 19 04:13 na-1-big-TOC.txt
-rw-r--r--. 1 root root  815 Aug 19 04:13 schema.cql</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively create symlinks to the snapshot folder instead of copying
the data, something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">mkdir keyspace_name
ln -s _path_to_snapshot_folder keyspace_name/table_name</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the <code>magazine</code> table was dropped run the DDL in the <code>schema.cql</code> to
create the table. Run the <code>sstableloader</code> with the following command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">sstableloader --nodes 10.0.2.238  /catalogkeyspace/magazine/</code></pre>
</div>
</div>
<div class="paragraph">
<p>As the output from the command indicates SSTables get streamed to the
cluster.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">[ec2-user@ip-10-0-2-238 ~]$ sstableloader --nodes 10.0.2.238  /catalogkeyspace/magazine/

Established connection to initial hosts
Opening SSTables and calculating sections to stream
Streaming relevant part of /catalogkeyspace/magazine/na-1-big-Data.db  to
[35.173.233.153:7000, 10.0.2.238:7000, 54.158.45.75:7000]
progress: [35.173.233.153:7000]0:1/1 176% total: 176% 0.017KiB/s (avg: 0.017KiB/s)
progress: [35.173.233.153:7000]0:1/1 176% total: 176% 0.000KiB/s (avg: 0.014KiB/s)
progress: [35.173.233.153:7000]0:1/1 176% [10.0.2.238:7000]0:1/1 78 % total: 108% 0.115KiB/s
(avg: 0.017KiB/s)
progress: [35.173.233.153:7000]0:1/1 176% [10.0.2.238:7000]0:1/1 78 %
[54.158.45.75:7000]0:1/1 78 % total: 96% 0.232KiB/s (avg: 0.024KiB/s)
progress: [35.173.233.153:7000]0:1/1 176% [10.0.2.238:7000]0:1/1 78 %
[54.158.45.75:7000]0:1/1 78 % total: 96% 0.000KiB/s (avg: 0.022KiB/s)
progress: [35.173.233.153:7000]0:1/1 176% [10.0.2.238:7000]0:1/1 78 %
[54.158.45.75:7000]0:1/1 78 % total: 96% 0.000KiB/s (avg: 0.021KiB/s)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Some other requirements of <code>sstableloader</code> that should be kept into
consideration are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The SSTables to be loaded must be compatible with the Cassandra
version being loaded into.</p>
</li>
<li>
<p>Repairing tables that have been loaded into a different cluster does
not repair the source tables.</p>
</li>
<li>
<p>Sstableloader makes use of port 7000 for internode communication.</p>
</li>
<li>
<p>Before restoring incremental backups run <code>nodetool flush</code> to backup
any data in memtables</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-nodetool-import"><a class="anchor" href="#using-nodetool-import"></a>Using nodetool import</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this section we shall import SSTables into a table using the
<code>nodetool import</code> command. The <code>nodetool refresh</code> command is deprecated,
and it is recommended to use <code>nodetool import</code> instead. The
<code>nodetool refresh</code> does not have an option to load new SSTables from a
separate directory which the <code>nodetool import</code> does.</p>
</div>
<div class="paragraph">
<p>The command usage is as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">nodetool [(-h &lt;host&gt; | --host &lt;host&gt;)] [(-p &lt;port&gt; | --port &lt;port&gt;)]
       [(-pp | --print-port)] [(-pw &lt;password&gt; | --password &lt;password&gt;)]
       [(-pwf &lt;passwordFilePath&gt; | --password-file &lt;passwordFilePath&gt;)]
       [(-u &lt;username&gt; | --username &lt;username&gt;)] import
       [(-c | --no-invalidate-caches)] [(-e | --extended-verify)]
       [(-l | --keep-level)] [(-q | --quick)] [(-r | --keep-repaired)]
       [(-t | --no-tokens)] [(-v | --no-verify)] [--] &lt;keyspace&gt; &lt;table&gt;
       &lt;directory&gt; ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The arguments <code>keyspace</code>, <code>table</code> name and <code>directory</code> to import
SSTables from are required.</p>
</div>
<div class="paragraph">
<p>The supported options are as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">-c, --no-invalidate-caches
    Don't invalidate the row cache when importing

-e, --extended-verify
    Run an extended verify, verifying all values in the new SSTables

-h &lt;host&gt;, --host &lt;host&gt;
    Node hostname or ip address

-l, --keep-level
    Keep the level on the new SSTables

-p &lt;port&gt;, --port &lt;port&gt;
    Remote jmx agent port number

-pp, --print-port
    Operate in 4.0 mode with hosts disambiguated by port number

-pw &lt;password&gt;, --password &lt;password&gt;
    Remote jmx agent password

-pwf &lt;passwordFilePath&gt;, --password-file &lt;passwordFilePath&gt;
    Path to the JMX password file

-q, --quick
    Do a quick import without verifying SSTables, clearing row cache or
    checking in which data directory to put the file

-r, --keep-repaired
    Keep any repaired information from the SSTables

-t, --no-tokens
    Don't verify that all tokens in the new SSTable are owned by the
    current node

-u &lt;username&gt;, --username &lt;username&gt;
    Remote jmx agent username

-v, --no-verify
    Don't verify new SSTables

--
    This option can be used to separate command-line options from the
    list of argument, (useful when arguments might be mistaken for
    command-line options</code></pre>
</div>
</div>
<div class="paragraph">
<p>As the keyspace and table are specified on the command line
<code>nodetool import</code> does not have the same requirement that
<code>sstableloader</code> does, which is to have the SSTables in a specific
directory path. When importing snapshots or incremental backups with
<code>nodetool import</code> the SSTables don’t need to be copied to another
directory.</p>
</div>
<div class="sect2">
<h3 id="importing-data-from-an-incremental-backup"><a class="anchor" href="#importing-data-from-an-incremental-backup"></a>Importing Data from an Incremental Backup</h3>
<div class="paragraph">
<p>In this section we shall demonstrate using <code>nodetool import</code> to import
SSTables from an incremental backup. We shall use the example table
<code>cqlkeyspace.t</code>. Drop table <code>t</code> as we are demonstrating to restore the
table.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">cqlsh:cqlkeyspace&gt; DROP table t;</code></pre>
</div>
</div>
<div class="paragraph">
<p>An incremental backup for a table does not include the schema definition
for the table. If the schema definition is not kept as a separate
backup, the <code>schema.cql</code> from a backup of the table may be used to
create the table as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">cqlsh:cqlkeyspace&gt; CREATE TABLE IF NOT EXISTS cqlkeyspace.t (
              ...         id int PRIMARY KEY,
              ...         k int,
              ...         v text)
              ...         WITH ID = d132e240-c217-11e9-bbee-19821dcea330
              ...         AND bloom_filter_fp_chance = 0.01
              ...         AND crc_check_chance = 1.0
              ...         AND default_time_to_live = 0
              ...         AND gc_grace_seconds = 864000
              ...         AND min_index_interval = 128
              ...         AND max_index_interval = 2048
              ...         AND memtable_flush_period_in_ms = 0
              ...         AND speculative_retry = '99p'
              ...         AND additional_write_policy = '99p'
              ...         AND comment = ''
              ...         AND caching = { 'keys': 'ALL', 'rows_per_partition': 'NONE' }
              ...         AND compaction = { 'max_threshold': '32', 'min_threshold': '4',
'class': 'org.apache.cassandra.db.compaction.SizeTieredCompactionStrategy' }
              ...         AND compression = { 'chunk_length_in_kb': '16', 'class':
'org.apache.cassandra.io.compress.LZ4Compressor' }
              ...         AND cdc = false
              ...         AND extensions = {  };</code></pre>
</div>
</div>
<div class="paragraph">
<p>Initially the table could be empty, but does not have to be.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">cqlsh:cqlkeyspace&gt; SELECT * FROM t;

id | k | v
----+---+---

(0 rows)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run the <code>nodetool import</code> command by providing the keyspace, table and
the backups directory. We don’t need to copy the table backups to
another directory to run <code>nodetool import</code> as we had to when using
<code>sstableloader</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">[ec2-user@ip-10-0-2-238 ~]$ nodetool import -- cqlkeyspace t
./cassandra/data/data/cqlkeyspace/t-d132e240c21711e9bbee19821dcea330/backups
[ec2-user@ip-10-0-2-238 ~]$</code></pre>
</div>
</div>
<div class="paragraph">
<p>The SSTables get imported into the table. Run a query in cqlsh to list
the data imported.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">cqlsh:cqlkeyspace&gt; SELECT * FROM t;

id | k | v
----+---+------
 1 | 1 | val1
 0 | 0 | val0</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="importing-data-from-a-snapshot"><a class="anchor" href="#importing-data-from-a-snapshot"></a>Importing Data from a Snapshot</h3>
<div class="paragraph">
<p>Importing SSTables from a snapshot with the <code>nodetool import</code> command is
similar to importing SSTables from an incremental backup. To demonstrate
we shall import a snapshot for table <code>catalogkeyspace.journal</code>. Drop the
table as we are demonstrating to restore the table from a snapshot.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">cqlsh:cqlkeyspace&gt; use CATALOGKEYSPACE;
cqlsh:catalogkeyspace&gt; DROP TABLE journal;</code></pre>
</div>
</div>
<div class="paragraph">
<p>We shall use the <code>catalog-ks</code> snapshot for the <code>journal</code> table. List the
files in the snapshot. The snapshot includes a <code>schema.cql</code>, which is
the schema definition for the <code>journal</code> table.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">[ec2-user@ip-10-0-2-238 catalog-ks]$ ls -l
total 44
-rw-rw-r--. 1 ec2-user ec2-user   31 Aug 19 02:44 manifest.json
-rw-rw-r--. 3 ec2-user ec2-user   47 Aug 19 02:38 na-1-big-CompressionInfo.db
-rw-rw-r--. 3 ec2-user ec2-user   97 Aug 19 02:38 na-1-big-Data.db
-rw-rw-r--. 3 ec2-user ec2-user   10 Aug 19 02:38 na-1-big-Digest.crc32
-rw-rw-r--. 3 ec2-user ec2-user   16 Aug 19 02:38 na-1-big-Filter.db
-rw-rw-r--. 3 ec2-user ec2-user   16 Aug 19 02:38 na-1-big-Index.db
-rw-rw-r--. 3 ec2-user ec2-user 4687 Aug 19 02:38 na-1-big-Statistics.db
-rw-rw-r--. 3 ec2-user ec2-user   56 Aug 19 02:38 na-1-big-Summary.db
-rw-rw-r--. 3 ec2-user ec2-user   92 Aug 19 02:38 na-1-big-TOC.txt
-rw-rw-r--. 1 ec2-user ec2-user  814 Aug 19 02:44 schema.cql</code></pre>
</div>
</div>
<div class="paragraph">
<p>Copy the DDL from the <code>schema.cql</code> and run in cqlsh to create the
<code>catalogkeyspace.journal</code> table.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">cqlsh:catalogkeyspace&gt; CREATE TABLE IF NOT EXISTS catalogkeyspace.journal (
                  ...         id int PRIMARY KEY,
                  ...         name text,
                  ...         publisher text)
                  ...         WITH ID = 296a2d30-c22a-11e9-b135-0d927649052c
                  ...         AND bloom_filter_fp_chance = 0.01
                  ...         AND crc_check_chance = 1.0
                  ...         AND default_time_to_live = 0
                  ...         AND gc_grace_seconds = 864000
                  ...         AND min_index_interval = 128
                  ...         AND max_index_interval = 2048
                  ...         AND memtable_flush_period_in_ms = 0
                  ...         AND speculative_retry = '99p'
                  ...         AND additional_write_policy = '99p'
                  ...         AND comment = ''
                  ...         AND caching = { 'keys': 'ALL', 'rows_per_partition': 'NONE' }
                  ...         AND compaction = { 'min_threshold': '4', 'max_threshold':
'32', 'class': 'org.apache.cassandra.db.compaction.SizeTieredCompactionStrategy' }
                  ...         AND compression = { 'chunk_length_in_kb': '16', 'class':
'org.apache.cassandra.io.compress.LZ4Compressor' }
                  ...         AND cdc = false
                  ...         AND extensions = {  };</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run the <code>nodetool import</code> command to import the SSTables for the
snapshot.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">[ec2-user@ip-10-0-2-238 ~]$ nodetool import -- catalogkeyspace journal
./cassandra/data/data/catalogkeyspace/journal-
296a2d30c22a11e9b1350d927649052c/snapshots/catalog-ks/
[ec2-user@ip-10-0-2-238 ~]$</code></pre>
</div>
</div>
<div class="paragraph">
<p>Subsequently run a CQL query on the <code>journal</code> table and the data
imported gets listed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">cqlsh:catalogkeyspace&gt;
cqlsh:catalogkeyspace&gt; SELECT * FROM journal;

id | name                      | publisher
----+---------------------------+------------------
 1 |        Couchbase Magazine |        Couchbase
 0 | Apache Cassandra Magazine | Apache Cassandra

(2 rows)
cqlsh:catalogkeyspace&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="bulk-loading-external-data"><a class="anchor" href="#bulk-loading-external-data"></a>Bulk Loading External Data</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Bulk loading external data directly is not supported by any of the tools
we have discussed which include <code>sstableloader</code> and <code>nodetool import</code>.
The <code>sstableloader</code> and <code>nodetool import</code> require data to be in the form
of SSTables. Apache Cassandra supports a Java API for generating
SSTables from input data. Subsequently the <code>sstableloader</code> or
<code>nodetool import</code> could be used to bulk load the SSTables. Next, we
shall discuss the <code>org.apache.cassandra.io.sstable.CQLSSTableWriter</code>
Java class for generating SSTables.</p>
</div>
<div class="sect2">
<h3 id="generating-sstables-with-cqlsstablewriter-java-api"><a class="anchor" href="#generating-sstables-with-cqlsstablewriter-java-api"></a>Generating SSTables with CQLSSTableWriter Java API</h3>
<div class="paragraph">
<p>To generate SSTables using the <code>CQLSSTableWriter</code> class the following
need to be supplied at the least.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An output directory to generate the SSTable in</p>
</li>
<li>
<p>The schema for the SSTable</p>
</li>
<li>
<p>A prepared insert statement</p>
</li>
<li>
<p>A partitioner</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The output directory must already have been created. Create a directory
(<code>/sstables</code> as an example) and set its permissions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">sudo mkdir /sstables
sudo chmod  777 -R /sstables</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, we shall discuss To use <code>CQLSSTableWriter</code> could be used in a Java
application. Create a Java constant for the output directory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">public static final String OUTPUT_DIR = "./sstables";</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>CQLSSTableWriter</code> Java API has the provision to create a user defined
type. Create a new type to store <code>int</code> data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">String type = "CREATE TYPE CQLKeyspace.intType (a int, b int)";
// Define a String variable for the SSTable schema.
String schema = "CREATE TABLE CQLKeyspace.t ("
                 + "  id int PRIMARY KEY,"
                 + "  k int,"
                 + "  v1 text,"
                 + "  v2 intType,"
                 + ")";</code></pre>
</div>
</div>
<div class="paragraph">
<p>Define a <code>String</code> variable for the prepared insert statement to use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">String insertStmt = "INSERT INTO CQLKeyspace.t (id, k, v1, v2) VALUES (?, ?, ?, ?)";</code></pre>
</div>
</div>
<div class="paragraph">
<p>The partitioner to use does not need to be set as the default
partitioner <code>Murmur3Partitioner</code> is used.</p>
</div>
<div class="paragraph">
<p>All these variables or settings are used by the builder class
<code>CQLSSTableWriter.Builder</code> to create a <code>CQLSSTableWriter</code> object.</p>
</div>
<div class="paragraph">
<p>Create a File object for the output directory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">File outputDir = new File(OUTPUT_DIR + File.separator + "CQLKeyspace" + File.separator + "t");</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, obtain a <code>CQLSSTableWriter.Builder</code> object using <code>static</code> method
<code>CQLSSTableWriter.builder()</code>. Set the output directory <code>File</code> object,
user defined type, SSTable schema, buffer size, prepared insert
statement, and optionally any of the other builder options, and invoke
the <code>build()</code> method to create a <code>CQLSSTableWriter</code> object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">CQLSSTableWriter writer = CQLSSTableWriter.builder()
                                             .inDirectory(outputDir)
                                             .withType(type)
                                             .forTable(schema)
                                             .withBufferSizeInMB(256)
                                             .using(insertStmt).build();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, set the SSTable data. If any user define types are used obtain a
<code>UserType</code> object for these:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">UserType userType = writer.getUDType("intType");</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add data rows for the resulting SSTable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">writer.addRow(0, 0, "val0", userType.newValue().setInt("a", 0).setInt("b", 0));
   writer.addRow(1, 1, "val1", userType.newValue().setInt("a", 1).setInt("b", 1));
   writer.addRow(2, 2, "val2", userType.newValue().setInt("a", 2).setInt("b", 2));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Close the writer, finalizing the SSTable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">writer.close();</code></pre>
</div>
</div>
<div class="paragraph">
<p>All the public methods the <code>CQLSSTableWriter</code> class provides including
some other methods that are not discussed in the preceding example are
as follows.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">addRow(java.util.List&lt;java.lang.Object&gt; values)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds a new row to the
writer. Returns a CQLSSTableWriter object. Each provided value type
should correspond to the types of the CQL column the value is for. The
correspondence between java type and CQL type is the same one than the
one documented at
www.datastax.com/drivers/java/2.0/apidocs/com/datastax/driver/core/DataType.Name.html#asJavaC
lass().</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">addRow(java.util.Map&lt;java.lang.String,java.lang.Object&gt; values)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds a
new row to the writer. Returns a CQLSSTableWriter object. This is
equivalent to the other addRow methods, but takes a map whose keys are
the names of the columns to add instead of taking a list of the values
in the order of the insert statement used during construction of this
SSTable writer. The column names in the map keys must be in lowercase
unless the declared column name is a case-sensitive quoted identifier in
which case the map key must use the exact case of the column. The values
parameter is a map of column name to column values representing the new
row to add. If a column is not included in the map, it&#8217;s value will be
null. If the map contains keys that do not correspond to one of the
columns of the insert statement used when creating this SSTable writer,
the corresponding value is ignored.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">addRow(java.lang.Object&#8230;&#8203; values)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds a new row to the writer.
Returns a CQLSSTableWriter object.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CQLSSTableWriter.builder()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns a new builder for a
CQLSSTableWriter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">close()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Closes the writer.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rawAddRow(java.nio.ByteBuffer&#8230;&#8203; values)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds a new row to the writer
given already serialized binary values. Returns a CQLSSTableWriter
object. The row values must correspond to the bind variables of the
insertion statement used when creating by this SSTable writer.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rawAddRow(java.util.List&lt;java.nio.ByteBuffer&gt; values)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds a new row
to the writer given already serialized binary values. Returns a
CQLSSTableWriter object. The row values must correspond to the bind
variables of the insertion statement used when creating by this SSTable
writer.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rawAddRow(java.util.Map&lt;java.lang.String, java.nio.ByteBuffer&gt; values)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds a new row to the writer given already serialized binary values.
Returns a CQLSSTableWriter object. The row values must correspond to the
bind variables of the insertion statement used when creating by this
SSTable writer.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">getUDType(String dataType)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the User Defined type used in this
SSTable Writer that can be used to create UDTValue instances.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>All the public methods the <code>CQLSSTableWriter.Builder</code> class provides
including some other methods that are not discussed in the preceding
example are as follows.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">inDirectory(String directory)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The directory where to write the
SSTables. This is a mandatory option. The directory to use should
already exist and be writable.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">inDirectory(File directory)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The directory where to write the SSTables.
This is a mandatory option. The directory to use should already exist
and be writable.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">forTable(String schema)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The schema (CREATE TABLE statement) for the
table for which SSTable is to be created. The provided CREATE TABLE
statement must use a fully-qualified table name, one that includes the
keyspace name. This is a mandatory option.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">withPartitioner(IPartitioner partitioner)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The partitioner to use. By
default, Murmur3Partitioner will be used. If this is not the partitioner
used by the cluster for which the SSTables are created, the correct
partitioner needs to be provided.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">using(String insert)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The INSERT or UPDATE statement defining the order
of the values to add for a given CQL row. The provided INSERT statement
must use a fully-qualified table name, one that includes the keyspace
name. Moreover, said statement must use bind variables since these
variables will be bound to values by the resulting SSTable writer. This
is a mandatory option.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">withBufferSizeInMB(int size)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The size of the buffer to use. This
defines how much data will be buffered before being written as a new
SSTable. This corresponds roughly to the data size that will have the
created SSTable. The default is 128MB, which should be reasonable for a
1GB heap. If OutOfMemory exception gets generated while using the
SSTable writer, should lower this value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sorted()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creates a CQLSSTableWriter that expects sorted inputs. If
this option is used, the resulting SSTable writer will expect rows to be
added in SSTable sorted order (and an exception will be thrown if that
is not the case during row insertion). The SSTable sorted order means
that rows are added such that their partition keys respect the
partitioner order. This option should only be used if the rows can be
provided in order, which is rarely the case. If the rows can be provided
in order however, using this sorted might be more efficient. If this
option is used, some option like withBufferSizeInMB will be ignored.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">build()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Builds a CQLSSTableWriter object.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../../_/js/site.js"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
