<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Testing :: Apache Cassandra Documentation</title>
    <meta name="generator" content="Antora 2.3.1">
    <link rel="stylesheet" href="../../../../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../../..">Apache Cassandra Documentation&nbsp;&nbsp;&nbsp;<img src="../../../../_/img/cassandra_logo.png"></a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Download</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Latest</a>
            <a class="navbar-item" href="#">3.x</a>
            <a class="navbar-item" href="#">3.0</a>
            <a class="navbar-item" href="#">2.1</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Documentation</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Latest</a>
            <a class="navbar-item" href="#">3.x</a>
            <a class="navbar-item" href="#">3.0</a>
            <a class="navbar-item" href="#">2.1</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Community</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Developer Mailing List</a>
            <a class="navbar-item" href="#">User Mailing List</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Blog</a>
	</div>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="ASCIIDOC_POC" data-version="4.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../index.html">ASCIIDOC_POC</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../index.html">Cassandra Documentation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../glossary.html">Glossary</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../bugs.html">How to report bugs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../contactus.html">Contact us</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Cassandra</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../architecture/index.html">Architecture</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../architecture/overview.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../architecture/dynamo.html">Dynamo</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../architecture/storage_engine.html">Storage engine</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../architecture/guarantees.html">Guarantees</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../new/index.html">What&#8217;s new</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../getting_started/index.html">Getting Started</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../getting_started/installing.html">Installing Cassandra</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../getting_started/configuring.html">Configuring Cassandra</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../getting_started/querying.html">Inserting and querying</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../getting_started/drivers.html">Client drivers</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../getting_started/production.html">Production recommendations</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../data_modeling/index.html">Data Modeling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#cql/index.adoc{">CQL</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/changes.html">Changes</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/ddl.html">DDL</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/dml.html">DML</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/types.html">Data types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/operators.html">Operators</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/definitions.html">Definitions</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/indexes.html">Secondary indexes</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/mvs.html">Materialized views</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/functions.html">Functions</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/json.html">JSON</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/security.html">Security</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/triggers.html">Triggers</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cql/appendices.html">Appendices</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration/index.html">Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operating/index.html">Operating</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tools/index.html">Tools</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html">Development</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/index.html">Plug-ins</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../troubleshooting/index.html">Troubleshooting</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../faq/index.html">FAQ</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">ASCIIDOC_POC</span>
    <span class="version">4.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">ASCIIDOC_POC</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../index.html">4.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../index.html">ASCIIDOC_POC</a></li>
    <li><a href="testing.html">Testing</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///Users/lorina.poland/CLONES/cassandra-examples/rst-to-asciidoc-tests/ASCIIDOC/modules/cassandra/pages/development/testing.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<article class="doc">
<h1 class="page">Testing</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Creating tests is one of the most important and also most difficult
parts of developing Cassandra. There are different ways to test your
code depending on what you&#8217;re working on.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="unit-testing"><a class="anchor" href="#unit-testing"></a>Unit Testing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The most simple way to test code in Cassandra is probably by writing a
unit test. Cassandra uses JUnit as a testing framework and test cases
can be found in the <code>test/unit</code> directory. Ideally you’d be able to
create a unit test for your implementation that would exclusively cover
the class you created (the unit under test). Unfortunately this is not
always possible and Cassandra doesn’t have a very mock friendly code
base. Often you’ll find yourself in a situation where you have to make
use of an embedded Cassandra instance that you’ll be able to interact
with in your test. If you want to make use of CQL in your test, you can
simply extend CQLTester and use some of the convenient helper methods
such as in the following example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Test
public void testBatchAndList() throws Throwable
{
   createTable("CREATE TABLE %s (k int PRIMARY KEY, l list&lt;int&gt;)");
   execute("BEGIN BATCH " +
           "UPDATE %1$s SET l = l +[ 1 ] WHERE k = 0; " +
           "UPDATE %1$s SET l = l + [ 2 ] WHERE k = 0; " +
           "UPDATE %1$s SET l = l + [ 3 ] WHERE k = 0; " +
           "APPLY BATCH");

   assertRows(execute("SELECT l FROM %s WHERE k = 0"),
              row(list(1, 2, 3)));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Unit tests can be run from the command line using the <code>ant test</code>
command, <code>ant test -Dtest.name=&lt;simple_classname&gt;</code> to execute a test
suite or
<code>ant testsome -Dtest.name=&lt;FQCN&gt; -Dtest.methods=&lt;testmethod1&gt;[,testmethod2]</code>
for individual tests. For example, to run all test methods in the
<code>org.apache.cassandra.cql3.SimpleQueryTest</code> class, you would run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">ant test -Dtest.name=SimpleQueryTest</code></pre>
</div>
</div>
<div class="paragraph">
<p>To run only the <code>testStaticCompactTables()</code> test method from that class,
you would run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">ant testsome -Dtest.name=org.apache.cassandra.cql3.SimpleQueryTest -Dtest.methods=testStaticCompactTables</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you see an error like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs" data-lang="none">Throws: cassandra-trunk/build.xml:1134: taskdef A class needed by class org.krummas.junit.JStackJUnitTask cannot be found:
org/apache/tools/ant/taskdefs/optional/junit/JUnitTask  using the classloader
AntClassLoader[/.../cassandra-trunk/lib/jstackjunit-0.0.1.jar]</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will need to install the ant-optional package since it contains the
<code>JUnitTask</code> class.</p>
</div>
<div class="sect2">
<h3 id="long-running-tests"><a class="anchor" href="#long-running-tests"></a>Long running tests</h3>
<div class="paragraph">
<p>Test that consume a significant amount of time during execution can be
found in the <code>test/long</code> directory and executed as a regular JUnit test
or standalone program. Except for the execution time, there’s nothing
really special about them. However, ant will execute tests under
<code>test/long</code> only when using the <code>ant long-test</code> target.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="dtests"><a class="anchor" href="#dtests"></a>DTests</h2>
<div class="sectionbody">
<div class="paragraph">
<p>One way of doing integration or system testing at larger scale is by
using <a href="https://github.com/apache/cassandra-dtest">dtest</a>, which stands for
“Cassandra Distributed Tests”. The idea is to automatically setup
Cassandra clusters using various configurations and simulate certain use
cases you want to test. This is done using Python scripts and <code>ccmlib</code>
from the <a href="https://github.com/pcmanus/ccm">ccm</a> project. Dtests will setup
clusters using this library just as you do running ad-hoc <code>ccm</code> commands
on your local machine. Afterwards dtests will use the
<a href="http://datastax.github.io/python-driver/installation.html">Python driver</a>
to interact with the nodes, manipulate the file system, analyze logs or
mess with individual nodes.</p>
</div>
<div class="paragraph">
<p>Using dtests helps us to prevent regression bugs by continually
executing tests on the <a href="https://builds.apache.org/">CI server</a> against new
patches. Committers will be able to set up build branches there and your
reviewer may use the CI environment to run tests for your patch. Read
more on the motivation behind continuous integration
<a href="http://www.datastax.com/dev/blog/cassandra-testing-improvements-for-developer-convenience-and-confidence">here</a>.</p>
</div>
<div class="paragraph">
<p>The best way to learn how to write dtests is probably by reading the
introduction "http://www.datastax.com/dev/blog/how-to-write-a-dtest[How
to Write a Dtest]" and by looking at existing, recently updated tests in
the project. New tests must follow certain
<a href="https://github.com/apache/cassandra-dtest/blob/master/CONTRIBUTING.md">style
conventions</a> that are being checked before accepting contributions. In
contrast to Cassandra, dtest issues and pull-requests are managed on
github, therefor you should make sure to link any created dtests in your
Cassandra ticket and also refer to the ticket number in your dtest PR.</p>
</div>
<div class="paragraph">
<p>Creating a good dtest can be tough, but it should not prevent you from
submitting patches! Please ask in the corresponding JIRA ticket how to
write a good dtest for the patch. In most cases a reviewer or committer
will able to support you, and in some cases they may offer to write a
dtest for you.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="performance-testing"><a class="anchor" href="#performance-testing"></a>Performance Testing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Performance tests for Cassandra are a special breed of tests that are
not part of the usual patch contribution process. In fact you can
contribute tons of patches to Cassandra without ever running performance
tests. They are important however when working on performance
improvements, as such improvements must be measurable.</p>
</div>
<div class="sect2">
<h3 id="cassandra-stress-tool"><a class="anchor" href="#cassandra-stress-tool"></a>Cassandra Stress Tool</h3>
<div class="paragraph">
<p>See <code>cassandra_stress</code></p>
</div>
</div>
<div class="sect2">
<h3 id="cstar_perf"><a class="anchor" href="#cstar_perf"></a>cstar_perf</h3>
<div class="paragraph">
<p>Another tool available on github is
<a href="https://github.com/datastax/cstar_perf">cstar_perf</a> that can be used for
intensive performance testing in large clusters or locally. Please refer
to the project page on how to set it up and how to use it.</p>
</div>
</div>
<div class="sect2">
<h3 id="circleci"><a class="anchor" href="#circleci"></a>CircleCI</h3>
<div class="paragraph">
<p>Cassandra ships with a default <a href="https://circleci.com">CircleCI</a>
configuration, to enable running tests on your branches, you need to go
the CircleCI website, click "Login" and log in with your github account.
Then you need to give CircleCI permission to watch your repositories.
Once you have done that, you can optionally configure CircleCI to run
tests in parallel - click "Projects", then your github account and then
click the settings for the project. If you leave the parallelism at 1
for Cassandra, only <code>ant eclipse-warnings</code> and <code>ant test</code> will be run.
If you up the parallelism to 4, it also runs <code>ant long-test</code>,
<code>ant test-compression</code> and <code>ant stress-test</code></p>
</div>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../../_/js/site.js"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
